(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{67:function(){},2061:function(){},6534:function(e,t,s){Promise.resolve().then(s.t.bind(s,7960,23)),Promise.resolve().then(s.bind(s,3490)),Promise.resolve().then(s.bind(s,5315)),Promise.resolve().then(s.bind(s,9556))},3490:function(e,t,s){"use strict";s.d(t,{AppProvider:function(){return x},b:function(){return h}});var a=s(7437),r=s(2265),l=s(8685),i=s(308);let n={organization:[{position:"คณะกรรมการบริหาร",id:999,name:"ท่านประธาน",dept:"คณะกรรมการ",salary:null,children:[]},{id:21,name:"ปิยธิดา แย้มเกษร",position:"ผู้จัดการ",dept:"ผู้จัดการ",salary:12e4,isAdmin:!0,canViewReport:!0,children:[{position:"หัวหน้าบัญชี",id:26,name:"ธัญญ์ศริน วราชุน",dept:"บัญชี",salary:48e3,children:[{position:"เจ้าหน้าที่",ids:[47,57],names:["ขวัญฤทัย จิตรบำรุง","พุทธวรรณ จิตตประกอบ"],salaries:[28e3,18e3]}]},{position:"ผู้ช่วยการเงิน",id:23,name:"ณัฏฐเวช เศรษฐศิโรตม์",dept:"การเงินและลงทุน",salary:85e3,children:[{position:"เจ้าหน้าที่",id:53,name:"ปฐมพงศ์ ใจช่วย",salary:35e3},{position:"ส่วนงานการเงินและลงทุน",isSection:!0,children:[{position:"หัวหน้า",id:22,name:"พรชนัน สมบูรณ์สวัสดิ์",salary:45e3,children:[{position:"เจ้าหน้าที่",ids:[59,65,51,25],names:["จิราพร ศรีวิชัย","ณฏฐณิชา อ่อนบาง","ณิชชา ไชยะกาล","วรพร ปั้นรัตน์"],salaries:[19e3,19500,25e3,38e3]}]}]}]},{position:"ผู้ช่วยไอที",id:19,name:"เกียรติณรงค์ ถนอมทรัพย์",dept:"ไอที",salary:9e4,isAdmin:!0,children:[{position:"ส่วนงานเทคโนโลยีสารสนเทศ",isSection:!0,children:[{position:"หัวหน้า",id:29,name:"สมัย เสริฐเจิม",salary:85e3,isAdmin:!0,children:[{position:"เจ้าหน้าที่",ids:[62,48],names:["กัณหา งิ้วออก","ตุลภัทร จัตุสุนทรกุล"],salaries:[29e3,39e3],isAdmins:[!0,!1]}]}]}]},{position:"รองผู้จัดการ",id:13,name:"อุราพร พิมพ์ทอง",dept:"รองผู้จัดการ",salary:95e3,children:[{position:"ส่วนงานสินเชื่อและกำแพงแสน",dept:"สินเชื่อและกำแพงแสน",isSection:!0,children:[{position:"ผู้ช่วยผู้จัดการ",id:11,name:"ธัญญา ศักดิ์กะทัศน์",salary:88e3,children:[{position:"หัวหน้า",id:17,name:"อรพรรณ โสภณธนะสิริ",salary:49e3,children:[{position:"เจ้าหน้าที่",ids:[58,8],names:["ณัฐชยา ทินกูล","ธมนวรรณ แสงจันทร์"],salaries:[15e3,6e4]}]},{position:"หัวหน้า",id:16,name:"ชวาลา บุญจันทร์",salary:75e3,children:[{position:"เจ้าหน้าที่",ids:[37,63,60,41],names:["ธมลวรรณ นาคสกุล","วรินทร์ธร เพิ่มศิริคณาชัย","ธนาเทพ พุทธา","พงษ์ศักดิ์ สิทธิภาพ"],salaries:[39e3,16e3,17e3,33e3]}]}]}]},{position:"ส่วนงานอำนวยการ",dept:"บริหารทั่วไป",isSection:!0,children:[{position:"ผู้ช่วยผู้จัดการ",id:49,name:"สุชญา อรุณินทร์",salary:82e3,children:[{position:"หัวหน้า",id:14,name:"สดใส ศรีเจริญสุข",salary:78e3,children:[{position:"เจ้าหน้าที่",ids:[18,56,64,31,61,38,32,50],names:["สุภาพร วงษ์สกุล","ชนิกานต์ จีระสมบัติ","ณัชชา ล้อมวงค์","พรพิมล เสาะด้น","พัทรดา วาณิชย์ราบรื่น","วชิราพร ไชยพงศ์","ศศิภา เพชรกรรพุม","พรภิชัย ทะวงศ์"],salaries:[41e3,12e3,13e3,31e3,14e3,34e3,36e3,24e3]}]}]}]}]}]}],exclusions:[{evaluator_id:53,target_id:22,reason:"ปฐมพงศ์ ไม่ต้องประเมิน พรชนัน"},{evaluator_id:58,target_id:16,reason:"ณัฐชยา ข้าม ชวาลา"},{evaluator_id:8,target_id:16,reason:"ธมนวรรณ ข้าม ชวาลา"},{evaluator_id:37,target_id:17,reason:"ธมลวรรณ ข้าม อรพรรณ"},{evaluator_id:63,target_id:17,reason:"วรินทร์ธร ข้าม อรพรรณ"},{evaluator_id:60,target_id:17,reason:"ธนาเทพ ข้าม อรพรรณ"},{evaluator_id:41,target_id:17,reason:"พงษ์ศักดิ์ ข้าม อรพรรณ"},{evaluator_id:22,target_id:53,reason:"พรชนัน ข้าม ปฐมพงศ์"},{evaluator_id:16,target_id:58,reason:"ชวาลา ข้าม ณัฐชยา"},{evaluator_id:16,target_id:8,reason:"ชวาลา ข้าม ธมนวรรณ"},{evaluator_id:17,target_id:49,reason:"อรพรรณ ข้าม สุชญา"},{evaluator_id:17,target_id:19,reason:"อรพรรณ ข้าม เกียรติณรงค์"},{evaluator_id:17,target_id:23,reason:"อรพรรณ ข้าม ณัฏฐเวช"}]},d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ส่วนกลาง",a=[],r=null,l=e.dept||s,n={canManageUsers:!1,canManageCriteria:!1,canManageAdjustments:!1,canUseAITool:!1,canManageSystem:!1};if(e.isSection)return e.children&&e.children.forEach(e=>{a=[...a,...d(e,t,l)]}),a;if(e.ids&&e.names)e.names.forEach((s,r)=>{let d=e.salaries?e.salaries[r]:null,o=e.ids[r],c=!!e.isAdmins&&e.isAdmins[r];a.push({internalId:(0,i._t)(),orgId:o,name:s,position:e.position,salary:d,salaryGroup:(0,i.MX)(d),role:(0,i.pV)(e.position),dept:l,parentInternalId:t,img:(0,i.wX)(o),isAdmin:c,canViewReport:!!e.canViewReports&&e.canViewReports[r],isActive:!0,permissions:{...n,canViewReport:e.canViewReport||!1}})});else if(e.name){r=(0,i._t)();let s=e.isAdmin||!1,d=e.canViewReport||!1;a.push({internalId:r,orgId:e.id,name:e.name,position:e.position,salary:e.salary,salaryGroup:(0,i.MX)(e.salary),role:(0,i.pV)(e.position),dept:l,parentInternalId:t,img:(0,i.wX)(e.id),isAdmin:s,canViewReport:d,isActive:!0,permissions:{...n,canViewReport:d}})}let o=r||t;return e.children&&e.children.forEach(e=>{a=[...a,...d(e,o,l)]}),a},o=n.organization.flatMap(e=>d(e));var c=s(5153);let m=(0,r.createContext)(void 0);function x(e){let{children:t}=e,[s,d]=(0,r.useState)("login"),[x,h]=(0,r.useState)(null),[u,p]=(0,r.useState)(null),[g,f]=(0,r.useState)(null),[j,b]=(0,r.useState)({}),[v,N]=(0,r.useState)({}),[y,w]=(0,r.useState)("role"),[C,E]=(0,r.useState)(l.rv),[S,I]=(0,r.useState)(l.wA),[k,A]=(0,r.useState)({startDate:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0],endDate:new Date(new Date().getFullYear(),11,31).toISOString().split("T")[0],sendEmailCopy:!1}),[T,_]=(0,r.useState)([]),[R,M]=(0,r.useState)([]),[D,F]=(0,r.useState)([]),[O,Z]=(0,r.useState)(!0),{toast:P}=(0,c.pm)(),z=async e=>{try{Z(!0);let t=(null==e?void 0:e.internalId)||(null==x?void 0:x.internalId),s="".concat(l.CT,"?action=get_init_data").concat(t?"&evaluator_id=".concat(t):""),a=await fetch(s,{cache:"no-store"});if(!a.ok){let e="Failed to fetch initial data";try{e=(await a.json()).error||e}catch(t){e=(await a.text()).substring(0,100)||e}throw Error(e)}let r=await a.json();if(r.error)throw Error(r.error);let i=(r.users||[]).map(e=>({...e,isAdmin:!!e.isAdmin,isActive:void 0===e.isActive||!!e.isActive,orgId:Number(e.orgId),salary:e.salary?Number(e.salary):null}));if(F(i),r.systemConfig){let e=r.systemConfig,t={startDate:e.start_date||e.startDate||k.startDate,endDate:e.end_date||e.endDate||k.endDate,sendEmailCopy:"true"===e.send_email_copy||!0===e.sendEmailCopy,smtpHost:e.smtp_host||e.smtpHost,smtpPort:e.smtp_port||e.smtpPort,smtpUser:e.smtp_user||e.smtpUser,smtpPass:e.smtp_pass||e.smtpPass,smtpEncryption:e.smtp_encryption||e.smtpEncryption||"tls"};A(t),(e.dept_adjustments||e.deptAdjustment)&&E(e.dept_adjustments||e.deptAdjustment)}b(r.scores||{}),N(r.comments||{}),r.criteria&&r.criteria.length>0&&I(r.criteria),r.exclusions&&M(r.exclusions)}catch(e){console.error("API Error:",e),P({variant:"destructive",title:"Connection Error",description:e instanceof Error?e.message:"Failed to load data from API. Using local backup if available."}),F(o),M(n.exclusions.map(e=>({id:Math.floor(1e6*Math.random()),evaluatorId:e.evaluator_id,targetId:e.target_id,reason:e.reason})))}finally{Z(!1)}},$=async e=>{try{let t="".concat(l.CT,"?action=get_init_data");(null==e?void 0:e.raw)&&(t+="&raw=true");let s=await fetch(t,{cache:"no-store"});if(!s.ok)throw Error("Failed to fetch report data");return await s.json()}catch(e){return console.error("Report Fetch Error:",e),null}},K=async e=>{if(!x)return!1;try{let t=await fetch("".concat(l.CT,"?action=send_evaluation_summary"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({evaluator_id:x.internalId,evaluation_data:e})}),s=await t.json();if(s.success)return P({title:"Email Sent",description:"สำเนาผลการประเมินถูกส่งไปที่อีเมลของคุณแล้ว"}),!0;throw Error(s.error||"Failed to send email")}catch(e){return console.error("Email Error:",e),P({variant:"destructive",title:"Email Failed",description:e.message||"ไม่สามารถส่งอีเมลได้"}),!1}};(0,r.useEffect)(()=>{z()},[s]);let V=(e,t)=>{_(s=>[...s,{timestamp:new Date().toISOString(),type:e,message:t,user:(null==x?void 0:x.name)||"Guest"}])},H=async(e,t,s)=>{if(b(a=>({...a,[e]:{...a[e]||{},[t]:s}})),x)try{await fetch("".concat(l.CT,"?action=update_score"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({evaluatorId:x.internalId,targetId:e,criteriaId:t,score:s})})}catch(e){console.error("Failed to save score",e),P({variant:"destructive",title:"Save Error",description:"Failed to save score to server. Please check connection."})}},G=async(e,t)=>{if(N(s=>({...s,[e]:t})),x)try{await fetch("".concat(l.CT,"?action=update_comment"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({evaluatorId:x.internalId,targetId:e,comment:t})})}catch(e){console.error("Failed to save comment",e),P({variant:"destructive",title:"Save Error",description:"Failed to save comment to server."})}},U=async e=>{A(e);try{let t={...e,deptAdjustment:e.deptAdjustment||C};await fetch("".concat(l.CT,"?action=update_config"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),V("ADMIN","Updated system configuration"),P({title:"บันทึกการตั้งค่าแล้ว",description:"ข้อมูลช่วงเวลาการประเมินถูกอัปเดตเรียบร้อย"})}catch(e){console.error("Config update failed",e),P({variant:"destructive",title:"Save Error",description:"Failed to save config to server"})}},L=async(e,t,s)=>{let a=Date.now(),r={id:a,evaluatorId:e,targetId:t,reason:s};M(e=>[...e,r]);try{let r=await fetch("".concat(l.CT,"?action=add_exclusion"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({evaluatorId:e,targetId:t,reason:s})}),i=await r.json();i.success&&i.id&&(M(e=>e.map(e=>e.id===a?{...e,id:i.id}:e)),P({title:"เพิ่มข้อยกเว้นแล้ว"}))}catch(e){console.error("Failed to add exclusion",e),M(e=>e.filter(e=>e.id!==a)),P({variant:"destructive",title:"Error",description:"Failed to add exclusion"})}},X=async e=>{let t=[...R];M(t=>t.filter(t=>t.id!==e));try{await fetch("".concat(l.CT,"?action=delete_exclusion"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}),P({title:"ลบข้อยกเว้นแล้ว"})}catch(e){console.error("Failed to delete exclusion",e),M(t),P({variant:"destructive",title:"Error",description:"Failed to delete exclusion"})}},B=async e=>{try{let t=await fetch("".concat(l.CT,"?action=save_user"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(s.error)throw Error(s.error)}catch(e){throw console.error("Failed to save user",e),e}},J=async e=>{try{let t=await fetch("".concat(l.CT,"?action=delete_user"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({internalId:e})}),s=await t.json();if(s.error)throw Error(s.error)}catch(e){throw console.error("Failed to delete user",e),e}},Y=async e=>{try{let t=await fetch("".concat(l.CT,"?action=import_users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(s.error)throw Error(s.error);return s}catch(e){throw console.error("Failed to import users",e),e}},q=async()=>{try{b({}),N({}),await fetch("".concat(l.CT,"?action=reset_data")),V("ADMIN","Reset all scores and comments"),P({title:"รีเซ็ตข้อมูลแล้ว",description:"คะแนนและความคิดเห็นทั้งหมดถูกล้างแล้ว"})}catch(e){console.error("Reset failed",e),P({variant:"destructive",title:"Error",description:"Failed to reset data on server"})}},Q=async e=>{I(t=>{let s=t.findIndex(t=>t.id===e.id);if(!(s>-1))return[...t,e];{let a=[...t];return a[s]=e,a}});try{let t=await fetch("".concat(l.CT,"?action=save_criteria"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(s.error)throw Error(s.error);P({title:"บันทึกหลักเกณฑ์แล้ว"})}catch(e){console.error("Failed to save criteria",e),P({variant:"destructive",title:"Error",description:"Failed to save criteria"})}},W=async e=>{I(t=>t.filter(t=>t.id!==e));try{let t=await fetch("".concat(l.CT,"?action=delete_criteria"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}),s=await t.json();if(s.error)throw Error(s.error);P({title:"ลบหลักเกณฑ์แล้ว"})}catch(e){console.error("Failed to delete criteria",e),P({variant:"destructive",title:"Error",description:"Failed to delete criteria"})}};return(0,a.jsx)(m.Provider,{value:{view:s,user:x,currentGroup:u,currentPerson:g,scores:j,comments:v,filterType:y,deptAdjustment:C,criteria:S,getCriteriaForUser:e=>{let t=["PERF"];if(e.role===l.K$.STAFF)t.push("CHAR");else{if(![l.K$.HEAD,l.K$.ASST,l.K$.MANAGER].includes(e.role))return[];t.push("EXEC")}return S.filter(e=>t.includes(e.category))},systemConfig:k,logs:T,exclusions:R,allUsers:D,login:e=>{h(e),d("dashboard"),V("LOGIN","User ".concat(e.name," logged in")),P({title:"เข้าสู่ระบบสำเร็จ",description:"ยินดีต้อนรับ, ".concat(e.name,"!")}),z(e)},logout:()=>{V("LOGOUT","User ".concat(null==x?void 0:x.name," logged out")),h(null),d("login"),P({title:"ออกจากระบบแล้ว",description:"คุณออกจากระบบเรียบร้อยแล้ว"})},navigateToGroup:e=>{p(e),d("evaluation")},navigateToIndividual:e=>{let t=new Date().toISOString().split("T")[0];(t<k.startDate||t>k.endDate)&&P({variant:"destructive",title:"นอกช่วงเวลาการประเมิน",description:"คุณสามารถดูได้เท่านั้น ไม่สามารถแก้ไขคะแนนได้"}),f(e),d("individual")},goBack:()=>{"evaluation"===s?(p(null),d("dashboard")):"individual"===s?(f(null),d("dashboard")):"admin"===s||"summary"===s||"profile"===s?d("dashboard"):d("login")},updateScore:H,setScores:b,updateComment:G,setView:d,setFilterType:w,setDeptAdjustment:E,setCriteria:I,setSystemConfig:A,addLog:V,setExclusions:M,resetScores:q,backupData:()=>{try{let e={version:l.Ji,timestamp:new Date().toISOString(),scores:j,comments:v,logs:T,allUsers:D,systemConfig:k,deptAdjustment:C,criteria:S,exclusions:R},t=JSON.stringify(e,null,2);(0,i.EZ)("assessai_backup_".concat(new Date().toISOString().slice(0,10),".json"),t),V("ADMIN","Backed up system data"),P({title:"สำรองข้อมูลสำเร็จ",description:"ไฟล์สำรองข้อมูล JSON ถูกดาวน์โหลดแล้ว"})}catch(e){V("ERROR","Backup failed"),P({variant:"destructive",title:"การสำรองข้อมูลล้มเหลว",description:"ไม่สามารถสร้างไฟล์สำรองข้อมูลได้"})}},setAllUsers:F,isLoading:O,updateSystemConfig:U,refreshData:z,fetchReportData:$,sendEvaluationEmail:K,addExclusion:L,removeExclusion:X,saveUser:B,deleteUser:J,importUsers:Y,saveCriteria:Q,deleteCriteria:W},children:t})}function h(){let e=(0,r.useContext)(m);if(void 0===e)throw Error("useAppContext must be used within an AppProvider");return e}},5315:function(e,t,s){"use strict";s.d(t,{default:function(){return tL}});var a=s(7437),r=s(3490),l=s(2265),i=s(4935),n=s(3420),d=s(407),o=s(4508);let c=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});c.displayName="Card";let m=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",s),...r})});m.displayName="CardHeader";let x=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});x.displayName="CardTitle";let h=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",s),...r})});h.displayName="CardDescription";let u=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",s),...r})});u.displayName="CardContent";let p=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",s),...r})});p.displayName="CardFooter";var g=s(7053),f=s(535);let j=(0,f.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),b=l.forwardRef((e,t)=>{let{className:s,variant:r,size:l,asChild:i=!1,...n}=e,d=i?g.g7:"button";return(0,a.jsx)(d,{className:(0,o.cn)(j({variant:r,size:l,className:s})),ref:t,...n})});b.displayName="Button";var v=s(4797),N=s(875),y=s(2135),w=s(401);let C=v.fC,E=v.ZA,S=v.B4,I=l.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(v.xz,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...l,children:[r,(0,a.jsx)(v.JO,{asChild:!0,children:(0,a.jsx)(N.Z,{className:"h-4 w-4 opacity-50"})})]})});I.displayName=v.xz.displayName;let k=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(v.u_,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(y.Z,{className:"h-4 w-4"})})});k.displayName=v.u_.displayName;let A=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(v.$G,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(N.Z,{className:"h-4 w-4"})})});A.displayName=v.$G.displayName;let T=l.forwardRef((e,t)=>{let{className:s,children:r,position:l="popper",...i}=e;return(0,a.jsx)(v.h_,{children:(0,a.jsxs)(v.VY,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...i,children:[(0,a.jsx)(k,{}),(0,a.jsx)(v.l_,{className:(0,o.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(A,{})]})})});T.displayName=v.VY.displayName,l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(v.__,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=v.__.displayName;let _=l.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(v.ck,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(v.wU,{children:(0,a.jsx)(w.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(v.eT,{children:r})]})});_.displayName=v.ck.displayName,l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(v.Z0,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=v.Z0.displayName;let R=l.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...l})});R.displayName="Input";var M=s(370);let D=(0,f.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),F=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(M.f,{ref:t,className:(0,o.cn)(D(),s),...r})});F.displayName=M.f.displayName;var O=s(5153),Z=s(8685),P=s(3643);let z=l.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(P.fC,{ref:t,className:(0,o.cn)("relative overflow-hidden",s),...l,children:[(0,a.jsx)(P.l_,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)($,{}),(0,a.jsx)(P.Ns,{})]})});z.displayName=P.fC.displayName;let $=l.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...l}=e;return(0,a.jsx)(P.gb,{ref:t,orientation:r,className:(0,o.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...l,children:(0,a.jsx)(P.q4,{className:"relative flex-1 rounded-full bg-border"})})});$.displayName=P.gb.displayName;var K=s(3145),V=()=>{let{login:e,allUsers:t,isLoading:s}=(0,r.b)(),[o,p]=(0,l.useState)(Z.mq),[g,f]=(0,l.useState)(""),[j,v]=(0,l.useState)(!1),[N,y]=(0,l.useState)(""),[w,E]=(0,l.useState)(!1),[k,A]=(0,l.useState)(""),[M,D]=(0,l.useState)(""),{toast:P}=(0,O.pm)(),$=(0,l.useMemo)(()=>Array.from(new Set(t.map(e=>e.dept))).sort(),[t]),V=(0,l.useMemo)(()=>{let e=[Z.K$.COMMITTEE,Z.K$.MANAGER,Z.K$.ASST,Z.K$.HEAD,Z.K$.STAFF];return t.filter(e=>e.dept===k&&e.isActive).sort((t,s)=>{let a=e.indexOf(t.role),r=e.indexOf(s.role);return a!==r?a-r:t.name.localeCompare(s.name,"th")})},[k,t]);(0,l.useEffect)(()=>{$.length>0&&!k&&A($[0])},[$,k]),(0,l.useEffect)(()=>{V.length>0?D(V[0].internalId):D("")},[V]),(0,l.useEffect)(()=>{v(!1),y(""),f("")},[M,o]);let H=async e=>{if(!e){P({title:"ไม่พบเบอร์โทรศัพท์",description:"ผู้ใช้งานนี้ยังไมได้ลงทะเบียนเบอร์โทรศัพท์ในระบบ",variant:"destructive"});return}E(!0),f(e);try{let t=await fetch("/api/otp/request?mobile_no=".concat(e)),s=await t.json(),a="";if("string"==typeof s){let e=s.match(/Ref:\s*([A-Za-z0-9]+)/);a=e?e[1]:""}else s.returnValue&&(a=s.returnValue);if(a||"string"==typeof s)v(!0),P({title:"ส่ง OTP สำเร็จ",description:"รหัส OTP ถูกส่งไปยัง ".concat(e," แล้ว").concat(a?" (Ref: ".concat(a,")"):"")});else throw Error(s.error||"Invalid response: ".concat(JSON.stringify(s)))}catch(e){console.error(e),P({title:"ส่ง OTP ไม่สำเร็จ (ข้อผิดพลาด)",description:e.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ OTP",variant:"destructive"}),v(!1)}finally{E(!1)}};return(0,a.jsxs)("div",{className:"min-h-screen w-full flex items-center justify-center bg-gradient-to-br from-indigo-50 via-white to-cyan-50 p-4 relative animate-fade-in",children:[Z.mq&&(0,a.jsx)(b,{onClick:()=>p(!o),variant:o?"default":"outline",size:"icon",className:"absolute top-6 right-6 rounded-full shadow-md transition-all h-10 w-10 bg-white/80 backdrop-blur-sm hover:scale-105 active:scale-95",title:"Toggle Dev Mode",children:(0,a.jsx)(i.Z,{className:"h-5 w-5 text-gray-700"})}),(0,a.jsxs)(c,{className:"w-full max-w-md shadow-2xl shadow-indigo-100 border-0 rounded-3xl overflow-hidden bg-white/90 backdrop-blur-xl",children:[(0,a.jsxs)(m,{className:"text-center pt-10 pb-6",children:[(0,a.jsx)("div",{className:"bg-gradient-to-tr from-primary to-indigo-600 w-20 h-20 rounded-2xl rotate-3 flex items-center justify-center mx-auto mb-6 shadow-xl shadow-primary/30 transform transition-transform hover:rotate-6",children:(0,a.jsx)(n.Z,{className:"text-white w-10 h-10"})}),(0,a.jsx)(x,{className:"font-headline text-3xl text-gray-800 tracking-tight",children:"Performance Eval"}),(0,a.jsx)(h,{className:"text-base text-gray-500 mt-2",children:"ระบบประเมินผลการปฏิบัติงานเจ้าหน้าที่ สอ.มก."})]}),(0,a.jsxs)(u,{className:"px-8 pb-10",children:[s?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-primary"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm font-medium animate-pulse",children:"กำลังเชื่อมต่อฐานข้อมูล..."})]}):(0,a.jsxs)("form",{onSubmit:s=>{s.preventDefault();let a=t.find(e=>e.internalId===M);if(a){if(o)e(a);else if(j){if(N.length<4)return;P({title:"เข้าสู่ระบบสำเร็จ",description:"ยืนยันตัวตนเรียบร้อยแล้ว",variant:"default"}),e(a)}else{if(!a.mobile){P({title:"ไม่พบเบอร์โทรศัพท์",description:"กรุณาติดต่อผู้ดูแลระบบเพื่อเพิ่มเบอร์โทรศัพท์",variant:"destructive"});return}H(a.mobile)}}},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"department-select",className:"text-gray-700 font-medium ml-1",children:"สายการประเมิน"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)(C,{value:k,onValueChange:A,children:[(0,a.jsx)(I,{id:"department-select",className:"h-14 rounded-2xl border-gray-200 bg-gray-50/50 focus:ring-2 focus:ring-primary/20 focus:border-primary px-4 text-base shadow-sm",children:(0,a.jsx)(S,{placeholder:"เลือกสายการประเมิน"})}),(0,a.jsx)(T,{className:"rounded-xl shadow-xl border-0",children:$.map(e=>(0,a.jsx)(_,{value:e,className:"py-3 px-4 focus:bg-indigo-50 rounded-lg cursor-pointer text-base",children:e},e))})]})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"user-select",className:"text-gray-700 font-medium ml-1",children:"ชื่อผู้ใช้งาน"}),(0,a.jsxs)(C,{value:M,onValueChange:D,disabled:0===V.length,children:[(0,a.jsx)(I,{id:"user-select",className:"h-14 rounded-2xl border-gray-200 bg-gray-50/50 focus:ring-2 focus:ring-primary/20 focus:border-primary px-4 text-base shadow-sm",children:(0,a.jsx)(S,{placeholder:"เลือกผู้ใช้งาน"})}),(0,a.jsx)(T,{className:"rounded-xl shadow-xl border-0 max-h-[300px]",children:V.map(e=>(0,a.jsx)(_,{value:e.internalId,className:"py-3 pl-8 pr-4 focus:bg-indigo-50 rounded-lg cursor-pointer data-[highlighted]:bg-indigo-50 [&[data-highlighted]_span:first-of-type]:!text-primary [&[data-highlighted]_span:last-of-type]:!text-primary/70",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"relative w-8 h-8 rounded-full overflow-hidden border border-gray-100 shadow-sm",children:(0,a.jsx)(K.default,{src:e.img,fill:!0,className:"object-cover",alt:e.name})}),(0,a.jsxs)("div",{className:"flex flex-col text-left",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900 text-sm",children:e.name}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.position})]})]})},e.internalId))})]})]}),!o&&(0,a.jsxs)("div",{className:"p-5 bg-gradient-to-r from-emerald-50 to-green-50 rounded-2xl border border-emerald-100 text-emerald-800 shadow-inner",children:[(0,a.jsxs)("div",{className:"font-bold mb-2 flex items-center gap-2 text-emerald-700",children:[(0,a.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-emerald-500 animate-pulse shadow-lg shadow-emerald-500/50"}),"โหมดเข้าสู่ระบบด้วย OTP"]}),j?(0,a.jsxs)("div",{className:"space-y-4 mt-3 animate-in slide-in-from-top-2",children:[(0,a.jsx)(F,{className:"text-emerald-700 font-medium",children:"กรอกรหัส OTP (4 หลัก)"}),(0,a.jsx)(R,{placeholder:"• • • •",className:"text-center tracking-[1em] text-2xl font-bold h-16 bg-white border-emerald-200 focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/20 rounded-xl shadow-sm placeholder:tracking-widest placeholder:text-emerald-200/50",maxLength:4,value:N,onChange:e=>y(e.target.value),autoFocus:!0,inputMode:"numeric",pattern:"[0-9]*"}),(0,a.jsxs)("div",{className:"flex justify-between items-center px-1",children:[(0,a.jsxs)("p",{className:"text-xs text-emerald-600 font-medium bg-emerald-100/50 px-2 py-1 rounded-md",children:["ส่งไปยัง: ",g]}),(0,a.jsx)("button",{type:"button",onClick:()=>v(!1),className:"text-xs text-emerald-600 underline hover:text-emerald-800",children:"ขอใหม่"})]})]}):(0,a.jsx)("p",{className:"text-sm text-emerald-600/90 leading-relaxed",children:"ระบบจะส่งรหัส OTP ไปยังเบอร์โทรศัพท์ที่ท่านลงทะเบียนไว้ เพื่อยืนยันตัวตน"})]}),(0,a.jsxs)(b,{type:"submit",className:"w-full h-14 text-lg font-bold rounded-2xl shadow-lg transition-all transform active:scale-[0.98] ".concat(o?"bg-gradient-to-r from-primary to-indigo-600 hover:from-primary/90 hover:to-indigo-700 shadow-primary/30":"bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 shadow-emerald-500/30"),size:"lg",disabled:!M||w||!o&&j&&N.length<4,children:[w?(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white/80"}),"กำลังส่ง OTP..."]}):o?"เข้าสู่ระบบ":j?"ยืนยันรหัส OTP":"ขอรับรหัส OTP",!w&&(0,a.jsx)(d.Z,{className:"ml-2 h-6 w-6 opacity-80"})]})]}),(0,a.jsxs)("div",{className:"text-center mt-8 text-[10px] text-gray-300 font-mono uppercase tracking-widest",children:["v",Z.Ji]}),o&&(0,a.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-100 animate-in fade-in zoom-in-95 duration-300",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4 px-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-indigo-600",children:[(0,a.jsx)(i.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Debug Mode: Quick Login"})]}),(0,a.jsx)("span",{className:"text-[10px] bg-indigo-50 text-indigo-400 px-2 py-1 rounded-full font-mono",children:"DEBUG"})]}),(0,a.jsx)(z,{className:"h-64 -mr-4 pr-4",children:(0,a.jsx)("div",{className:"space-y-2 pb-2",children:t.filter(e=>e.isActive).sort((e,t)=>{let s=e.role===Z.K$.COMMITTEE,a=t.role===Z.K$.COMMITTEE;if(s&&!a)return 1;if(!s&&a)return -1;let r=[Z.K$.MANAGER,Z.K$.ASST,Z.K$.HEAD,Z.K$.STAFF],l=r.indexOf(e.role),i=r.indexOf(t.role);return -1!==l&&-1!==i&&l!==i?l-i:e.name.localeCompare(t.name,"th")}).map(t=>(0,a.jsxs)("div",{onClick:()=>e(t),className:"flex items-center gap-3 p-3 bg-white hover:bg-indigo-50 rounded-xl border border-gray-100 hover:border-indigo-200 cursor-pointer transition-all active:scale-[0.99] group shadow-sm hover:shadow-md",children:[(0,a.jsx)("div",{className:"relative w-10 h-10 rounded-full overflow-hidden border-2 border-white shadow-sm group-hover:border-indigo-100 transition-colors",children:(0,a.jsx)(K.default,{src:t.img,fill:!0,className:"object-cover",alt:t.name})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 text-left",children:[(0,a.jsxs)("div",{className:"text-sm font-bold truncate text-gray-800 group-hover:text-indigo-700 transition-colors",children:[t.name,t.isAdmin&&(0,a.jsx)("span",{className:"ml-2 text-[9px] bg-indigo-600 text-white px-1.5 py-0.5 rounded-md font-bold tracking-wide align-middle",children:"ADMIN"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 group-hover:text-gray-700 truncate flex items-center gap-1.5 mt-0.5",children:[(0,a.jsx)("span",{className:"bg-gray-100 px-1.5 py-0.5 rounded-md border border-gray-200 text-[10px] font-medium group-hover:bg-indigo-50 group-hover:border-indigo-200 group-hover:text-indigo-700",children:t.dept}),(0,a.jsx)("span",{className:"truncate",children:t.position})]})]})]},t.internalId))})})]})]})]}),(0,a.jsxs)("div",{className:"fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none -z-10",children:[(0,a.jsx)("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-100/40 rounded-full blur-3xl opacity-60 animate-pulse"}),(0,a.jsx)("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-cyan-100/40 rounded-full blur-3xl opacity-60 animate-pulse delay-1000"})]})]})},H=s(308),G=s(8728),U=s(1592),L=s(8736),X=s(7815),B=s(7692),J=s(6865),Y=s(1671),q=s(5805),Q=s(5252),W=s(1505);let ee=l.forwardRef((e,t)=>{let{className:s,value:r,indicatorClassName:l,...i}=e;return(0,a.jsx)(W.fC,{ref:t,className:(0,o.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...i,children:(0,a.jsx)(W.z$,{className:(0,o.cn)("h-full w-full flex-1 bg-primary transition-all",l),style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});ee.displayName=W.fC.displayName;var et=s(1668);let es=et.zt,ea=et.fC,er=et.xz,el=l.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...l}=e;return(0,a.jsx)(et.VY,{ref:t,sideOffset:r,className:(0,o.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})});el.displayName=et.VY.displayName;let ei=(0,f.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function en(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,o.cn)(ei({variant:s}),t),...r})}var ed=s(8617),eo=s(5005),ec=s(1884),em=s(8906),ex=s(2369);let eh=e=>{var t;let{targets:s,groupLabel:r,groupKey:l,scores:i,filterType:n,getCriteriaForUser:o,navigateToIndividual:g,navigateToGroup:f}=e,j=s.every(e=>{let t=o(e);if(0===t.length)return!0;let s=i[e.internalId]||{};return t.every(e=>s[e.id])});return(0,a.jsxs)(c,{className:"overflow-hidden shadow-lg shadow-indigo-100 hover:shadow-2xl hover:shadow-indigo-200 hover:-translate-y-1 hover:scale-[1.02] transition-all duration-300 flex flex-col h-full rounded-3xl border-0 bg-white/90 backdrop-blur-sm group/card ring-1 ring-gray-50 active:scale-[0.98]",children:[(0,a.jsxs)(m,{className:"pb-3 pt-6 px-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("div",{className:"p-4 rounded-2xl bg-indigo-50/50 group-hover/card:bg-indigo-100 transition-colors duration-300 shadow-sm",children:(()=>{if("salary"===n)return(0,a.jsx)(Q.Z,{className:"h-7 w-7 text-muted-foreground"});switch(l){case Z.K$.COMMITTEE:return(0,a.jsx)(ed.Z,{className:"h-7 w-7 text-yellow-600"});case Z.K$.MANAGER:return(0,a.jsx)(eo.Z,{className:"h-7 w-7 text-blue-600"});case Z.K$.ASST:return(0,a.jsx)(ec.Z,{className:"h-7 w-7 text-indigo-600"});case Z.K$.HEAD:return(0,a.jsx)(em.Z,{className:"h-7 w-7 text-purple-600"});case Z.K$.STAFF:return(0,a.jsx)(ex.Z,{className:"h-7 w-7 text-slate-600"});default:return(0,a.jsx)(q.Z,{className:"h-7 w-7 text-muted-foreground"})}})()}),(0,a.jsx)("div",{className:"text-right",children:j?(0,a.jsxs)(en,{className:"bg-emerald-100 text-emerald-800 border-none px-3 py-1 rounded-full font-medium shadow-sm",children:[(0,a.jsx)(Y.Z,{className:"w-3 h-3 mr-1"})," ครบถ้วน"]}):(0,a.jsxs)("div",{className:"flex flex-col items-end",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground font-medium uppercase tracking-wide",children:"จำนวน"}),(0,a.jsxs)("p",{className:"font-bold text-2xl text-gray-800 leading-none mt-1",children:[s.length," ",(0,a.jsx)("span",{className:"text-sm font-normal text-gray-400",children:"คน"})]})]})})]}),(0,a.jsx)(x,{className:"font-headline pt-5 truncate text-xl text-gray-800",title:r,children:r}),(0,a.jsx)(h,{className:"h-5 text-sm font-medium opacity-80",children:"role"===n?null===(t=s[0])||void 0===t?void 0:t.type:"ระดับเงินเดือน"})]}),(0,a.jsxs)(u,{className:"flex-1 min-h-0 flex flex-col px-6",children:[(0,a.jsx)("div",{className:"md:hidden mt-4 space-y-3",children:s.map(e=>{let t=o(e),s=t.length>0&&t.every(t=>{var s;return null===(s=i[e.internalId])||void 0===s?void 0:s[t.id]}),r=Math.round((0,H.tf)(e.internalId,i,t));return(0,a.jsxs)("div",{onClick:()=>g(e),className:"flex items-center gap-4 p-3 rounded-2xl bg-gray-50 border border-gray-100 active:scale-[0.98] active:bg-indigo-50 transition-all cursor-pointer shadow-sm",children:[(0,a.jsx)(K.default,{src:e.img,width:48,height:48,className:"w-12 h-12 rounded-full border-2 border-white shadow-sm object-cover",alt:e.name}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-base font-bold text-gray-800 truncate",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500 truncate flex items-center gap-2 mt-0.5",children:(0,a.jsx)("span",{className:"font-medium bg-white px-2 py-0.5 rounded-md border border-gray-200",children:e.position})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[r>0&&(0,a.jsx)("span",{className:"text-sm font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded-lg",children:r}),s?(0,a.jsx)("div",{className:"bg-emerald-100 p-1.5 rounded-full",children:(0,a.jsx)(Y.Z,{className:"h-5 w-5 text-emerald-600"})}):(0,a.jsx)(d.Z,{className:"h-5 w-5 text-gray-300"})]})]},e.internalId)})}),(0,a.jsxs)("div",{className:"hidden md:flex flex-col gap-2 mt-4 px-1 overflow-y-auto max-h-[260px] custom-scrollbar pr-2 -mr-2",children:[s.map(e=>{let t=o(e),s=t.length>0&&t.every(t=>{var s;return null===(s=i[e.internalId])||void 0===s?void 0:s[t.id]}),r=Math.round((0,H.tf)(e.internalId,i,t));return(0,a.jsxs)("div",{onClick:()=>g(e),className:"flex items-center gap-3 text-sm justify-between group hover:bg-slate-50 p-2 rounded-xl transition-all cursor-pointer border border-transparent hover:border-slate-100 active:scale-[0.98]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 min-w-0 overflow-hidden",children:[(0,a.jsx)(K.default,{src:e.img,width:36,height:36,className:"w-9 h-9 rounded-full border-2 border-white shadow-sm object-cover bg-gray-100 shrink-0",alt:e.name}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("div",{className:"font-bold truncate ".concat(s?"text-emerald-700":"text-gray-700"),children:e.name}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground truncate opacity-80",children:e.position})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 shrink-0",children:[r>0&&(0,a.jsx)("span",{className:"text-xs font-bold bg-indigo-50 text-indigo-700 px-2 py-0.5 rounded-md",children:r}),s&&(0,a.jsx)(Y.Z,{className:"h-4 w-4 text-emerald-500"})]})]},e.internalId)}),s.length>4&&(0,a.jsx)("div",{className:"text-center py-2 sticky bottom-0 bg-gradient-to-t from-white via-white/90 to-transparent pt-4",children:(0,a.jsxs)("span",{className:"text-[10px] text-gray-400 font-medium px-3 py-1 bg-gray-50 rounded-full flex items-center justify-center gap-1 mx-auto w-fit animate-pulse border border-gray-100",children:[(0,a.jsx)(N.Z,{className:"h-3 w-3"})," เลื่อนเพื่อดูเพิ่มเติม (",s.length-4,")"]})})]})]}),(0,a.jsx)(p,{className:"hidden md:flex p-6 pt-2",children:(0,a.jsxs)(b,{onClick:()=>f(l),className:"w-full h-12 rounded-xl text-base font-bold shadow-md bg-gradient-to-r from-indigo-600 to-primary hover:from-indigo-700 hover:to-indigo-800 transition-all active:scale-[0.98]",children:["ประเมินกลุ่ม ",(0,a.jsx)(d.Z,{className:"ml-2 h-5 w-5"})]})})]})};var eu=s(1817),ep=s(9345),eg=()=>{let{user:e,logout:t,navigateToGroup:s,scores:i,setView:n,navigateToIndividual:d,filterType:o,setFilterType:h,exclusions:p,allUsers:g,getCriteriaForUser:f,systemConfig:j,sendEvaluationEmail:v,comments:N}=(0,r.b)(),[y,w]=l.useState(!1),C=(0,l.useMemo)(()=>{let e=new Date().toISOString().split("T")[0];return e<j.startDate||e>j.endDate},[j]),E=async()=>{if(e){w(!0);try{let t=S.map(e=>{let t=i[e.internalId]||{},s=f(e),a=Object.values(t).reduce((e,t)=>e+Number(t),0),r=4*s.length,l=r>0?a/r*100:0,n="N/A";return l>=90?n="ดีเยี่ยม":l>=80?n="ดีมาก":l>=70?n="ดี":l>=60?n="พอใช้":l>0&&(n="ควรปรับปรุง"),{name:e.name,position:e.position,dept:e.dept,score:a,maxScore:r,level:n,comment:N[e.internalId]||"-",details:s.map(e=>({text:e.text,score:t[e.id]||0}))}});await v({evaluatorName:e.name,evaluatorPosition:e.position,date:new Date().toLocaleDateString("th-TH"),summary:t})}catch(e){console.error("Email Error:",e)}finally{w(!1)}}},S=(0,l.useMemo)(()=>e?(0,H.EQ)(e,g,p).filter(e=>e.role!==Z.K$.COMMITTEE):[],[e,g,p]),{groupedTargets:I,sortedGroupEntries:k}=(0,l.useMemo)(()=>{let e={};S.forEach(t=>{let s="salary"===o?t.salaryGroup||"N/A":t.role;e[s]||(e[s]=[]),e[s].push(t)});let t={[Z.K$.COMMITTEE]:1,[Z.K$.MANAGER]:2,[Z.K$.ASST]:3,[Z.K$.HEAD]:4,[Z.K$.STAFF]:5};Object.keys(e).forEach(s=>{e[s].sort((e,s)=>{let a=t[e.role]||99,r=t[s.role]||99;if(a!==r)return a-r;if(e.role===Z.K$.ASST&&s.role===Z.K$.ASST){let t=e.position.includes("รอง"),a=s.position.includes("รอง");if(t&&!a)return -1;if(!t&&a)return 1}return e.name.localeCompare(s.name,"th")})});let s=Object.entries(e).sort((e,t)=>{let[s]=e,[a]=t;if("role"===o){let e=[Z.K$.COMMITTEE,Z.K$.MANAGER,Z.K$.ASST,Z.K$.HEAD,Z.K$.STAFF],t=e.indexOf(s),r=e.indexOf(a);return(-1===t?999:t)-(-1===r?999:r)}let r=["เกิน 100,000","เกิน 50,000","เกิน 40,000","เกิน 30,000","เกิน 20,000","ไม่เกิน 20,000","ไม่จัดกลุ่ม","N/A"],l=r.indexOf(s),i=r.indexOf(a);return(-1===l?999:l)-(-1===i?999:i)});return{groupedTargets:e,sortedGroupEntries:s}},[S,o]),{progressPercent:A,completedPeople:T}=(0,l.useMemo)(()=>{let e=0;S.forEach(t=>{let s=f(t);if(0===s.length)return;let a=0;i[t.internalId]&&s.forEach(e=>{i[t.internalId][e.id]&&a++}),a===s.length&&s.length>0&&e++});let t=S.length;return{progressPercent:t>0?Math.round(e/t*100):0,completedPeople:e}},[S,i,f]);if(!e)return null;let _=e.isAdmin||e.canViewReport;return(0,a.jsx)(es,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 pb-20 animate-fade-in font-sans",children:[(0,a.jsxs)("header",{className:"bg-white/80 backdrop-blur-md shadow-sm px-6 py-5 flex justify-between items-center sticky top-0 z-30 border-b border-white/20 transition-all",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"relative group cursor-pointer transition-transform hover:scale-105",onClick:()=>n("profile"),children:[(0,a.jsx)("div",{className:"w-14 h-14 rounded-full border-4 border-white shadow-md overflow-hidden bg-gray-100 ring-2 ring-transparent group-hover:ring-primary/20 transition-all",children:(0,a.jsx)(K.default,{src:e.img,width:56,height:56,alt:e.name,className:"object-cover w-full h-full"})}),(0,a.jsx)("div",{className:"absolute bottom-0 right-0 w-4 h-4 rounded-full bg-emerald-500 border-2 border-white"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-xl font-bold font-headline text-gray-800 tracking-tight flex items-center gap-2",children:["สวัสดี, ",(0,a.jsx)("span",{className:"text-primary",children:e.name})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)("p",{className:"text-[11px] font-bold text-gray-400 uppercase tracking-wider",children:e.position}),(0,a.jsx)("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),(0,a.jsxs)("p",{className:"text-[11px] font-bold text-indigo-500 uppercase tracking-wider",children:["รอบการประเมิน: ",new Date(j.startDate).toLocaleDateString("th-TH")," - ",new Date(j.endDate).toLocaleDateString("th-TH")]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(e.isAdmin||e.canViewReport)&&(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{asChild:!0,children:(0,a.jsx)(b,{variant:"ghost",size:"icon",onClick:()=>n("admin"),className:"h-10 w-10 rounded-full hover:bg-indigo-50 transition-all hover:scale-105 hover:shadow-md",children:(0,a.jsx)(G.Z,{className:"h-5 w-5 text-gray-600 hover:text-primary"})})}),(0,a.jsx)(el,{children:(0,a.jsx)("p",{children:e.isAdmin?"แผงควบคุมผู้ดูแล":"จัดการการปรับฐานคะแนน"})})]}),_&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{asChild:!0,children:(0,a.jsx)(b,{variant:"ghost",size:"icon",onClick:()=>n("progress"),className:"h-10 w-10 rounded-full hover:bg-purple-50 transition-all hover:scale-105 hover:shadow-md",children:(0,a.jsx)(U.Z,{className:"h-5 w-5 text-gray-600 hover:text-purple-600"})})}),(0,a.jsx)(el,{children:(0,a.jsx)("p",{children:"ความคืบหน้า"})})]}),(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{asChild:!0,children:(0,a.jsx)(b,{variant:"ghost",size:"icon",onClick:()=>n("summary"),className:"h-10 w-10 rounded-full hover:bg-emerald-50 transition-all hover:scale-105 hover:shadow-md",children:(0,a.jsx)(L.Z,{className:"h-5 w-5 text-gray-600 hover:text-emerald-600"})})}),(0,a.jsx)(el,{children:(0,a.jsx)("p",{children:"รายงานสรุป"})})]})]}),j.sendEmailCopy&&(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{asChild:!0,children:(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full hover:bg-blue-50 transition-all hover:scale-105 hover:shadow-md",onClick:E,disabled:y,children:y?(0,a.jsx)(eu.Z,{className:"h-5 w-5 animate-spin text-blue-600"}):(0,a.jsx)(ep.Z,{className:"h-5 w-5 text-gray-600 hover:text-blue-600"})})}),(0,a.jsx)(el,{children:"ส่งสำเนาเข้าเมลของฉัน"})]}),(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{asChild:!0,children:(0,a.jsx)(b,{variant:"ghost",size:"icon",onClick:()=>n("profile"),className:"h-10 w-10 rounded-full hover:bg-blue-50 transition-all hover:scale-105 hover:shadow-md",children:(0,a.jsx)(X.Z,{className:"h-5 w-5 text-gray-600 hover:text-blue-600"})})}),(0,a.jsx)(el,{children:(0,a.jsx)("p",{children:"โปรไฟล์"})})]}),(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{asChild:!0,children:(0,a.jsx)(b,{variant:"ghost",size:"icon",onClick:t,className:"h-10 w-10 rounded-full hover:bg-red-50 text-red-500 hover:text-red-600 transition-all hover:scale-105 hover:shadow-md",children:(0,a.jsx)(B.Z,{className:"h-5 w-5"})})}),(0,a.jsx)(el,{children:(0,a.jsx)("p",{children:"ออกจากระบบ"})})]})]})]}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto p-4 md:p-8 space-y-10",children:[C&&(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-2xl p-4 flex items-center gap-4 animate-in fade-in slide-in-from-top-4",children:[(0,a.jsx)("div",{className:"bg-amber-100 p-2 rounded-xl",children:(0,a.jsx)(J.Z,{className:"h-6 w-6 text-amber-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-amber-900 font-bold text-sm",children:"อยู่นอกช่วงเวลาการประเมิน"}),(0,a.jsx)("p",{className:"text-amber-700 text-xs",children:"คุณสามารถเรียกดูข้อมูลย้อนหลังได้ แต่จะไม่สามารถแก้ไขคะแนนหรือความคิดเห็นได้ในขณะนี้"})]})]}),(0,a.jsxs)(c,{className:"bg-gradient-to-r from-indigo-600 to-primary text-white shadow-xl shadow-indigo-500/20 rounded-3xl overflow-hidden border-0 relative",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"}),(0,a.jsx)(m,{className:"pb-2 relative z-10",children:(0,a.jsxs)(x,{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"flex items-center gap-3 text-lg font-medium opacity-90",children:[(0,a.jsx)("span",{className:"bg-white/20 p-2 rounded-lg",children:(0,a.jsx)(Y.Z,{className:"h-5 w-5"})}),"สถานะการประเมินภาพรวม"]}),(0,a.jsxs)("span",{className:"text-4xl font-bold font-headline tracking-tight drop-shadow-sm",children:[A,"%"]})]})}),(0,a.jsxs)(u,{className:"relative z-10",children:[(0,a.jsx)(ee,{value:A,className:"h-4 bg-black/20 rounded-full backdrop-blur-sm",indicatorClassName:"bg-gradient-to-r from-emerald-300 to-emerald-400"}),(0,a.jsxs)("div",{className:"flex justify-between text-white/80 text-sm mt-3 font-medium",children:[(0,a.jsxs)("span",{children:["ผู้ที่ต้องประเมินทั้งหมด ",(0,a.jsx)("span",{className:"text-white font-bold",children:S.length})," คน"]}),(0,a.jsxs)("span",{children:["ประเมินเสร็จแล้ว ",(0,a.jsx)("span",{className:"text-white font-bold",children:T})," คน"]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,a.jsxs)("h2",{className:"text-2xl text-gray-800 font-bold font-headline flex items-center gap-3",children:[(0,a.jsx)("span",{className:"w-1.5 h-8 bg-primary rounded-full"}),"รายการประเมินของคุณ"]}),(0,a.jsxs)("div",{className:"flex bg-white/60 p-1.5 rounded-2xl shadow-sm border border-gray-100 self-end md:self-center backdrop-blur-sm",children:[(0,a.jsxs)(b,{onClick:()=>h("role"),variant:"role"===o?"default":"ghost",size:"sm",className:"gap-2 rounded-xl transition-all h-9 ".concat("role"===o?"bg-indigo-600 hover:bg-indigo-700 shadow-md transform scale-105":"text-gray-500 hover:bg-white/50"),children:[(0,a.jsx)(q.Z,{size:16}),"แยกตามตำแหน่ง"]}),(0,a.jsxs)(b,{onClick:()=>h("salary"),variant:"salary"===o?"default":"ghost",size:"sm",className:"gap-2 rounded-xl transition-all h-9 ".concat("salary"===o?"bg-indigo-600 hover:bg-indigo-700 shadow-md transform scale-105":"text-gray-500 hover:bg-white/50"),children:[(0,a.jsx)(Q.Z,{size:16}),"แยกตามกลุ่มเงินเดือน"]})]})]}),0===S.length?(0,a.jsxs)("div",{className:"text-center py-20 bg-white/60 rounded-3xl border-2 border-dashed border-gray-200 text-gray-400 backdrop-blur-sm",children:[(0,a.jsx)("div",{className:"mb-4 bg-gray-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto text-gray-300",children:(0,a.jsx)(Y.Z,{className:"h-10 w-10"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-500",children:"ดีเยี่ยม! คุณไม่มีรายการที่ต้องประเมินแล้ว"}),(0,a.jsx)("p",{className:"text-sm mt-1 opacity-70",children:"คุณได้ดำเนินการครบถ้วนสมบูรณ์"})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8",children:k.map(e=>{let[t,r]=e,l="role"===o&&Z.Sx[t]||t;return(0,a.jsx)(eh,{targets:r,groupLabel:l,groupKey:t,scores:i,filterType:o,getCriteriaForUser:f,navigateToIndividual:d,navigateToGroup:s},t)})})]})]})]})})},ef=s(8124),ej=s(5363),eb=s(1169),ev=s(2660);let eN=[{id:"system",label:"ตั้งค่าระบบ",icon:G.Z,adminOnly:!0},{id:"users",label:"จัดการผู้ใช้",icon:q.Z,adminOnly:!0},{id:"criteria",label:"หลักเกณฑ์",icon:L.Z,adminOnly:!0,allowReportViewer:!0},{id:"org",label:"โครงสร้างองค์กร",icon:ef.Z,adminOnly:!1},{id:"adjustments",label:"ปรับฐานคะแนน",icon:ej.Z,adminOnly:!1},{id:"permissions",label:"จัดการสิทธิ์",icon:eb.Z,adminOnly:!0}];function ey(e){let{activeTab:t,setActiveTab:s,onBack:r,user:l}=e,i=eN.filter(e=>null!=l&&!!l.isAdmin||!!e.allowReportViewer&&null!=l&&!!l.canViewReport||!e.adminOnly);return(0,a.jsxs)("aside",{className:"w-full md:w-72 bg-slate-900/95 backdrop-blur-md text-slate-200 flex-shrink-0 flex flex-col h-auto md:h-screen sticky top-0 z-30 border-r border-slate-800 shadow-2xl",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-slate-800/50 bg-slate-950/20",children:[(0,a.jsxs)("h2",{className:"font-bold font-headline text-xl text-white tracking-tight flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-tr from-indigo-500 to-cyan-500 flex items-center justify-center shadow-lg shadow-indigo-500/20",children:(0,a.jsx)(G.Z,{className:"w-5 h-5 text-white"})}),(null==l?void 0:l.isAdmin)?"Admin Console":"Manager Tools"]}),(0,a.jsx)("p",{className:"text-xs text-slate-500 mt-2 font-medium tracking-wide uppercase pl-1",children:"Performance Eval System"})]}),(0,a.jsx)("nav",{className:"flex-1 p-4 space-y-1.5 overflow-y-auto custom-scrollbar",children:i.map(e=>(0,a.jsxs)(b,{onClick:()=>s(e.id),variant:"ghost",className:(0,o.cn)("w-full justify-start gap-3 h-11 rounded-xl transition-all duration-200",t===e.id?"bg-gradient-to-r from-indigo-600 to-indigo-500 text-white shadow-lg shadow-indigo-900/20 font-semibold translate-x-1":"text-slate-400 hover:bg-slate-800/50 hover:text-white hover:translate-x-1"),children:[(0,a.jsx)(e.icon,{className:(0,o.cn)("h-5 w-5 transition-colors",t===e.id?"text-indigo-100":"text-slate-500 group-hover:text-slate-300")}),e.label]},e.id))}),(0,a.jsx)("div",{className:"p-4 border-t border-slate-800/50 bg-slate-950/20",children:(0,a.jsxs)(b,{onClick:r,variant:"ghost",className:"w-full justify-start gap-3 text-slate-400 hover:bg-slate-800 hover:text-white h-12 rounded-xl",children:[(0,a.jsx)(ev.Z,{className:"h-5 w-5"})," ย้อนกลับ"]})})]})}let ew=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,o.cn)("w-full caption-bottom text-sm",s),...r})})});ew.displayName="Table";let eC=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("thead",{ref:t,className:(0,o.cn)("[&_tr]:border-b",s),...r})});eC.displayName="TableHeader";let eE=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,o.cn)("[&_tr:last-child]:border-0",s),...r})});eE.displayName="TableBody",l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,o.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...r})}).displayName="TableFooter";let eS=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tr",{ref:t,className:(0,o.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r})});eS.displayName="TableRow";let eI=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("th",{ref:t,className:(0,o.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});eI.displayName="TableHead";let ek=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("td",{ref:t,className:(0,o.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});ek.displayName="TableCell",l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("caption",{ref:t,className:(0,o.cn)("mt-4 text-sm text-muted-foreground",s),...r})}).displayName="TableCaption";var eA=s(721);let eT=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eA.fC,{className:(0,o.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...r,ref:t,children:(0,a.jsx)(eA.bU,{className:(0,o.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});eT.displayName=eA.fC.displayName;var e_=s(1),eR=s(2489);let eM=e_.fC;e_.xz;let eD=e_.h_,eF=e_.x8,eO=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(e_.aV,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});eO.displayName=e_.aV.displayName;let eZ=l.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(eD,{children:[(0,a.jsx)(eO,{}),(0,a.jsxs)(e_.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...l,children:[r,(0,a.jsxs)(e_.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(eR.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});eZ.displayName=e_.VY.displayName;let eP=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};eP.displayName="DialogHeader";let ez=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};ez.displayName="DialogFooter";let e$=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(e_.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});e$.displayName=e_.Dx.displayName;let eK=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(e_.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",s),...r})});eK.displayName=e_.dk.displayName;var eV=s(9270);let eH=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eV.fC,{ref:t,className:(0,o.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:(0,a.jsx)(eV.z$,{className:(0,o.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(w.Z,{className:"h-4 w-4"})})})});function eG(e){let{isOpen:t,onClose:s,onSave:r,user:i}=e,[n,d]=l.useState(!!(null==i?void 0:i.isAdmin)),[o,c]=l.useState(!!(null==i?void 0:i.canViewReport));return l.useEffect(()=>{d(!!(null==i?void 0:i.isAdmin)),c(!!(null==i?void 0:i.canViewReport))},[i]),(0,a.jsx)(eM,{open:t,onOpenChange:e=>!e&&s(),children:(0,a.jsxs)(eZ,{className:"sm:max-w-[600px] animate-fade-in-up",children:[(0,a.jsx)(eP,{children:(0,a.jsx)(e$,{className:"font-headline",children:i?"แก้ไขข้อมูลผู้ใช้":"เพิ่มผู้ใช้ใหม่"})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=new FormData(e.target);r({orgId:Number(t.get("orgId")),memberId:t.get("memberId"),name:t.get("name"),position:t.get("position"),dept:t.get("dept"),salary:Number(t.get("salary")),role:t.get("role"),mobile:t.get("mobile"),email:t.get("email"),isAdmin:n,canViewReport:o})},className:"grid gap-6 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"orgId",children:"รหัสพนักงาน"}),(0,a.jsx)(R,{id:"orgId",name:"orgId",type:"number",defaultValue:(null==i?void 0:i.orgId)||"",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"memberId",children:"เลขสมาชิก"}),(0,a.jsx)(R,{id:"memberId",name:"memberId",defaultValue:(null==i?void 0:i.memberId)||"",placeholder:"สำหรับดึงรูปภาพ"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"mobile",children:"เบอร์โทรศัพท์"}),(0,a.jsx)(R,{id:"mobile",name:"mobile",defaultValue:(null==i?void 0:i.mobile)||"",placeholder:"08xxxxxxxx"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"name",children:"ชื่อ-นามสกุล"}),(0,a.jsx)(R,{id:"name",name:"name",defaultValue:(null==i?void 0:i.name)||"",required:!0})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"position",children:"ตำแหน่ง"}),(0,a.jsx)(R,{id:"position",name:"position",defaultValue:(null==i?void 0:i.position)||"",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"email",children:"อีเมล"}),(0,a.jsx)(R,{id:"email",name:"email",type:"email",defaultValue:(null==i?void 0:i.email)||"",placeholder:"example@coop.ku.ac.th"})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"dept",children:"แผนก"}),(0,a.jsx)(R,{id:"dept",name:"dept",defaultValue:(null==i?void 0:i.dept)||"",required:!0})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"salary",children:"เงินเดือน"}),(0,a.jsx)(R,{id:"salary",name:"salary",type:"number",defaultValue:(null==i?void 0:i.salary)||"",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"role",children:"บทบาท"}),(0,a.jsxs)(C,{name:"role",defaultValue:(null==i?void 0:i.role)||Z.K$.STAFF,children:[(0,a.jsx)(I,{id:"role",children:(0,a.jsx)(S,{placeholder:"เลือกบทบาท"})}),(0,a.jsx)(T,{children:Object.entries(Z.Sx).map(e=>{let[t,s]=e;return(0,a.jsx)(_,{value:t,children:s},t)})})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 pt-4 border-t mt-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eH,{id:"isAdmin",checked:n,onCheckedChange:e=>d(!!e)}),(0,a.jsx)(F,{htmlFor:"isAdmin",className:"font-medium",children:"สิทธิ์แอดมิน"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eH,{id:"canViewReport",checked:o,onCheckedChange:e=>c(!!e)}),(0,a.jsx)(F,{htmlFor:"canViewReport",className:"font-medium",children:"สิทธิ์ดูรายงาน"})]})]}),(0,a.jsxs)(ez,{children:[(0,a.jsx)(eF,{asChild:!0,children:(0,a.jsx)(b,{type:"button",variant:"outline",children:"ยกเลิก"})}),(0,a.jsx)(b,{type:"submit",children:"บันทึก"})]})]})]})})}eH.displayName=eV.fC.displayName;var eU=s(7880);let eL=eU.fC;eU.xz;let eX=eU.h_,eB=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eU.aV,{className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:t})});eB.displayName=eU.aV.displayName;let eJ=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsxs)(eX,{children:[(0,a.jsx)(eB,{}),(0,a.jsx)(eU.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r})]})});eJ.displayName=eU.VY.displayName;let eY=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};eY.displayName="AlertDialogHeader";let eq=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};eq.displayName="AlertDialogFooter";let eQ=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eU.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold",s),...r})});eQ.displayName=eU.Dx.displayName;let eW=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eU.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",s),...r})});eW.displayName=eU.dk.displayName;let e0=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eU.aU,{ref:t,className:(0,o.cn)(j(),s),...r})});e0.displayName=eU.aU.displayName;let e1=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eU.$j,{ref:t,className:(0,o.cn)(j({variant:"outline"}),"mt-2 sm:mt-0",s),...r})});function e2(e){let{open:t,onOpenChange:s,onConfirm:r,title:l,description:i}=e;return(0,a.jsx)(eL,{open:t,onOpenChange:s,children:(0,a.jsxs)(eJ,{children:[(0,a.jsxs)(eY,{children:[(0,a.jsx)(eQ,{children:l}),(0,a.jsx)(eW,{children:i})]}),(0,a.jsxs)(eq,{children:[(0,a.jsx)(e1,{children:"Cancel"}),(0,a.jsx)(e0,{onClick:r,children:"Confirm"})]})]})})}e1.displayName=eU.$j.displayName;var e5=s(3247),e4=s(4942),e3=s(7689),e6=s(9397),e8=s(8893),e9=s(8930),e7=s(2093),te=()=>{let{allUsers:e,setAllUsers:t,addLog:s,saveUser:i,deleteUser:n,importUsers:d,refreshData:o}=(0,r.b)(),[x,h]=(0,l.useState)(""),[p,g]=(0,l.useState)(!1),[f,j]=(0,l.useState)(!1),[v,N]=(0,l.useState)(null),[y,w]=(0,l.useState)(null),{toast:C}=(0,O.pm)(),E=e.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())||e.dept.toLowerCase().includes(x.toLowerCase())||e.email&&e.email.toLowerCase().includes(x.toLowerCase())),S=async(a,r)=>{let l=[...e],n=e.map(e=>e.internalId===a?{...e,[r]:!e[r]}:e);t(n);try{let e=n.find(e=>e.internalId===a);if(e){let t=await i(e);console.log("Toggle Permission Response:",t),s("ADMIN","Toggled ".concat(r," for user ID ").concat(a))}}catch(e){console.error("Toggle Permission Error:",e),t(l),C({variant:"destructive",title:"Update Failed",description:"Could not save changes."})}},I=e=>{w(e),j(!0)},k=async()=>{if(y){try{await n(y),await o(),s("ADMIN","Deleted user ID ".concat(y)),C({title:"ลบผู้ใช้แล้ว",description:"ผู้ใช้ถูกลบออกจากระบบอย่างถาวร"})}catch(e){C({variant:"destructive",title:"Delete Failed",description:"Could not delete user."})}w(null)}j(!1)},A=async e=>{try{let t={...e};e.salary&&(t.salaryGroup=(0,H.MX)(e.salary)),(null==v?void 0:v.internalId)?t.internalId=v.internalId:(t.internalId=(0,H._t)(),t.img=(0,H.wX)(e.orgId),t.isActive=!0,t.isAdmin=!1,t.canViewReport=!1);let a=await i(t);console.log("Save User Response:",a),await o(),s("ADMIN","Saved user ".concat(e.name)),C({title:"บันทึกสำเร็จ",description:"ข้อมูลของ ".concat(e.name," ถูกบันทึกแล้ว")})}catch(e){console.error("Save User Error:",e),C({variant:"destructive",title:"บันทึกล้มเหลว",description:"ไม่สามารถบันทึกข้อมูลได้"})}g(!1),N(null)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-headline",children:"จัดการผู้ใช้"}),(0,a.jsxs)(c,{children:[(0,a.jsx)(m,{children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"relative w-full md:w-1/3",children:[(0,a.jsx)(e5.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(R,{placeholder:"ค้นหาตามชื่อหรือแผนก...",className:"pl-10",value:x,onChange:e=>h(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(b,{variant:"outline",onClick:()=>{(0,H.EZ)("user_import_template.csv","รหัสพนักงาน,เลขสมาชิก,ชื่อ-นามสกุล,ตำแหน่ง,แผนก,เงินเดือน,ระดับ(COMMITTEE/MANAGER/ASST/HEAD/STAFF),เบอร์โทรศัพท์,อีเมล")},children:[(0,a.jsx)(e4.Z,{className:"mr-2 h-4 w-4"})," เทมเพลต"]}),(0,a.jsxs)(b,{variant:"outline",onClick:()=>{let e=document.createElement("input");e.type="file",e.accept=".xlsx, .xls, .csv",e.onchange=async e=>{let t=e.target.files[0];if(!t)return;let a=new FileReader;a.onload=async e=>{try{let t=e.target.result,a=e7.ij(t,{type:"binary"}),r=a.SheetNames[0],l=a.Sheets[r],i=e7.P6.sheet_to_json(l),n=e=>e.replace(/^(นาย|นาง|นางสาว|ดร\.|ผศ\.|รศ\.|ศ\.|ว่าที่ร้อยตรี|ว่าที่ร\.ต\.)\s*/g,"").trim(),c=i.map(e=>{let t=e["เงินเดือน"]?Number(e["เงินเดือน"]):0,s=e["ชื่อ-นามสกุล"]||"",a=e["รหัสพนักงาน"]?Number(e["รหัสพนักงาน"]):0,r=e["เลขสมาชิก"]?String(e["เลขสมาชิก"]):void 0;return{internalId:e.InternalID||(0,H._t)(),orgId:a,memberId:r,name:n(s),position:e["ตำแหน่ง"]||"",dept:e["แผนก"]||"",salary:t,salaryGroup:(0,H.MX)(t),role:e["ระดับ(COMMITTEE/MANAGER/ASST/HEAD/STAFF)"]||"STAFF",mobile:e["เบอร์โทรศัพท์"]?String(e["เบอร์โทรศัพท์"]):void 0,email:e["อีเมล"]?String(e["อีเมล"]):void 0,parentInternalId:null,img:r?"https://apps2.coop.ku.ac.th/asset/staff/2568/crop/".concat(r,".jpg"):(0,H.wX)(a),isAdmin:!1,canViewReport:!1,isActive:!0}});c.length>0?(C({title:"กำลังนำเข้า...",description:"กำลังบันทึก ".concat(c.length," รายการ...")}),await d(c),await o(),C({title:"นำเข้าสำเร็จ",description:"นำเข้า ".concat(c.length," ผู้ใช้เรียบร้อยแล้ว")}),s("IMPORT","Imported ".concat(c.length," users"))):C({variant:"destructive",title:"ไม่พบข้อมูล",description:"ไฟล์ไม่มีข้อมูลที่ถูกต้อง"})}catch(e){console.error("Import Error",e),C({variant:"destructive",title:"นำเข้าล้มเหลว",description:"เกิดข้อผิดพลาดในการอ่านไฟล์"})}},a.readAsBinaryString(t)},e.click()},children:[(0,a.jsx)(e3.Z,{className:"mr-2 h-4 w-4"})," นำเข้า"]}),(0,a.jsxs)(b,{variant:"outline",onClick:()=>{let t="รหัสพนักงาน,เลขสมาชิก,ชื่อ-นามสกุล,ตำแหน่ง,แผนก,เงินเดือน,ระดับ,เบอร์โทรศัพท์,อีเมล,InternalID\n"+e.map(e=>"".concat(e.orgId||"",",").concat(e.memberId||"",',"').concat(e.name,'","').concat(e.position,'","').concat(e.dept,'",').concat(e.salary,",").concat(e.role,",").concat(e.mobile||"",",").concat(e.email||"",",").concat(e.internalId)).join("\n");(0,H.EZ)("users_export.csv",t),s("EXPORT","Exported ".concat(e.length," users")),C({title:"ส่งออกสำเร็จ",description:"ส่งออกข้อมูลผู้ใช้ ".concat(e.length," รายการแล้ว")})},children:[(0,a.jsx)(e4.Z,{className:"mr-2 h-4 w-4"})," ส่งออก"]}),(0,a.jsxs)(b,{onClick:()=>{N(null),g(!0)},children:[(0,a.jsx)(e6.Z,{className:"mr-2 h-4 w-4"})," เพิ่มผู้ใช้"]})]})]})}),(0,a.jsx)(u,{children:(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(ew,{children:[(0,a.jsx)(eC,{children:(0,a.jsxs)(eS,{children:[(0,a.jsx)(eI,{className:"w-[300px]",children:"ผู้ใช้งาน"}),(0,a.jsx)(eI,{children:"รายละเอียด"}),(0,a.jsx)(eI,{children:"แอดมิน"}),(0,a.jsx)(eI,{children:"สิทธิ์รายงาน"}),(0,a.jsx)(eI,{className:"text-right",children:"จัดการ"})]})}),(0,a.jsx)(eE,{children:E.map(e=>(0,a.jsxs)(eS,{className:e.isActive?"":"opacity-40",children:[(0,a.jsx)(ek,{className:"font-medium",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(K.default,{src:e.img,width:40,height:40,className:"w-10 h-10 rounded-full",alt:e.name}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["ID: ",e.orgId," ",e.memberId&&(0,a.jsxs)("span",{children:["| MEM: ",e.memberId]})]})]})]})}),(0,a.jsxs)(ek,{children:[(0,a.jsxs)("p",{children:[e.position," / ",e.dept]}),(0,a.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,a.jsx)(en,{variant:"secondary",children:e.role})}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 mt-1",children:[e.mobile&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,a.jsx)("span",{className:"font-medium text-gray-500",children:"Tel:"})," ",e.mobile]}),e.email&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,a.jsx)("span",{className:"font-medium text-gray-500",children:"Mail:"})," ",e.email]})]})]}),(0,a.jsx)(ek,{children:(0,a.jsx)(eT,{checked:e.isAdmin,onCheckedChange:()=>S(e.internalId,"isAdmin"),"aria-label":"Toggle admin status"})}),(0,a.jsx)(ek,{children:(0,a.jsx)(eT,{checked:e.canViewReport,onCheckedChange:()=>S(e.internalId,"canViewReport"),"aria-label":"Toggle report access"})}),(0,a.jsx)(ek,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(b,{variant:"ghost",size:"icon",onClick:()=>{N(e),g(!0)},children:(0,a.jsx)(e8.Z,{className:"h-4 w-4"})}),(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>I(e.internalId),children:(0,a.jsx)(e9.Z,{className:"h-4 w-4"})})]})})]},e.internalId))})]})})})]}),(0,a.jsx)(eG,{isOpen:p,onClose:()=>g(!1),onSave:A,user:v}),(0,a.jsx)(e2,{open:f,onOpenChange:j,onConfirm:k,title:"คุณแน่ใจหรือไม่?",description:"การกระทำนี้ไม่สามารถยกเลิกได้ จะเป็นการลบผู้ใช้และข้อมูลที่เกี่ยวข้องทั้งหมดอย่างถาวร"})]})},tt=s(3229);let ts=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...r})});ts.displayName="Textarea";var ta=()=>{let{criteria:e,addLog:t,saveCriteria:s,deleteCriteria:i}=(0,r.b)(),{toast:n}=(0,O.pm)(),[d,o]=(0,l.useState)(!1),[h,p]=(0,l.useState)(!1),[g,f]=(0,l.useState)(null),[j,v]=(0,l.useState)(null),[N,y]=(0,l.useState)(""),[w,E]=(0,l.useState)("PERF"),[k,A]=(0,l.useState)(0),[M,D]=(0,l.useState)(""),Z=e=>{f(e),y(e.text),E(e.category),A(e.weight),D(e.description||""),o(!0)},P=async()=>{if(!N||k<=0){n({variant:"destructive",title:"ข้อมูลไม่ครบถ้วน",description:"กรุณาระบุหัวข้อและน้ำหนักให้ถูกต้อง"});return}let e={id:(null==g?void 0:g.id)||"c-".concat(Date.now()),text:N,category:w,weight:k,description:M};await s(e),t("ADMIN","".concat(g?"Updated":"Added"," criteria: ").concat(N)),o(!1)},z=e=>{v(e),p(!0)},$=async()=>{j&&(await i(j),t("ADMIN","Deleted criteria ID ".concat(j)),v(null)),p(!1)};return e.reduce((e,t)=>e+t.weight,0),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-headline",children:"จัดการหลักเกณฑ์การประเมิน"}),(0,a.jsxs)(c,{children:[(0,a.jsxs)(m,{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[(0,a.jsx)("div",{className:"flex flex-col space-y-1",children:(0,a.jsx)(x,{children:"หลักเกณฑ์การประเมิน"})}),(0,a.jsxs)("div",{className:"flex gap-2 w-full md:w-auto",children:[(0,a.jsxs)(b,{variant:"outline",onClick:()=>{let t="ลำดับ,หัวข้อการประเมิน,หมวดหมู่(CORE/FUNC/MGT),น้ำหนัก(%)\n"+e.map((e,t)=>"".concat(t+1,',"').concat(e.text,'",').concat(e.category,",").concat(e.weight)).join("\n");(0,H.EZ)("criteria_template.csv",t)},children:[(0,a.jsx)(e4.Z,{className:"mr-2 h-4 w-4"})," เทมเพลต"]}),(0,a.jsxs)(b,{variant:"outline",onClick:()=>{n({title:"จำลองการนำเข้า..."}),setTimeout(()=>{n({title:"นำเข้าหลักเกณฑ์สำเร็จ",description:"หลักเกณฑ์การประเมินได้รับการอัปเดตแล้ว"}),t("IMPORT","Imported criteria from CSV")},1500)},children:[(0,a.jsx)(e3.Z,{className:"mr-2 h-4 w-4"})," นำเข้า"]}),(0,a.jsxs)(b,{variant:"outline",onClick:()=>{let s="ID,หัวข้อการประเมิน,หมวดหมู่,น้ำหนัก(%),คำอธิบาย\n"+e.map(e=>"".concat(e.id,',"').concat(e.text,'",').concat(e.category,",").concat(e.weight,',"').concat(e.description||"",'"')).join("\n");(0,H.EZ)("criteria_export.csv",s),t("EXPORT","Exported ".concat(e.length," criteria")),n({title:"ส่งออกสำเร็จ",description:"ส่งออกหลักเกณฑ์ ".concat(e.length," รายการแล้ว")})},children:[(0,a.jsx)(e4.Z,{className:"mr-2 h-4 w-4"})," ส่งออก"]}),(0,a.jsxs)(b,{onClick:()=>{f(null),y(""),E("PERF"),A(10),D(""),o(!0)},children:[(0,a.jsx)(e6.Z,{className:"mr-2 h-4 w-4"})," เพิ่มหลักเกณฑ์"]})]})]}),(0,a.jsx)(u,{children:(0,a.jsx)("div",{className:"space-y-6",children:["PERF","CHAR","EXEC","CORE","FUNC","MGT"].map(t=>{let s=e.filter(e=>e.category===t);return 0===s.length?null:(0,a.jsxs)("div",{className:"border rounded-lg p-4 bg-slate-50 dark:bg-slate-900",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"font-bold text-lg",children:{PERF:"Performance (ผลงาน)",CHAR:"Characteristics (คุณลักษณะ)",EXEC:"Executive (ผู้บริหาร)",CORE:"Core Competency",FUNC:"Functional Competency",MGT:"Managerial Competency"}[t]}),(0,a.jsxs)(en,{variant:"outline",children:["รวม ",s.reduce((e,t)=>e+t.weight,0),"%"]})]}),(0,a.jsx)("ul",{className:"space-y-2",children:s.map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsxs)("div",{className:"flex items-center justify-between py-3 bg-white dark:bg-slate-800 p-3 rounded shadow-sm",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("p",{className:"font-medium",children:e.text})}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("p",{className:"font-bold text-lg text-primary w-12 text-right",children:[e.weight,"%"]}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(b,{variant:"ghost",size:"icon",onClick:()=>Z(e),children:(0,a.jsx)(e8.Z,{className:"h-4 w-4"})}),(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>z(e.id),children:(0,a.jsx)(e9.Z,{className:"h-4 w-4"})})]})]})]})},e.id))})]},t)})})})]}),(0,a.jsx)(eM,{open:d,onOpenChange:o,children:(0,a.jsxs)(eZ,{children:[(0,a.jsx)(eP,{children:(0,a.jsx)(e$,{children:g?"แก้ไขหลักเกณฑ์":"เพิ่มหลักเกณฑ์ใหม่"})}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(F,{htmlFor:"category",className:"text-right",children:"หมวดหมู่"}),(0,a.jsxs)(C,{value:w,onValueChange:e=>E(e),children:[(0,a.jsx)(I,{className:"col-span-3",children:(0,a.jsx)(S,{placeholder:"เลือกหมวดหมู่"})}),(0,a.jsxs)(T,{children:[(0,a.jsx)(_,{value:"PERF",children:"Performance (ผลงาน)"}),(0,a.jsx)(_,{value:"CHAR",children:"Characteristics (คุณลักษณะ)"}),(0,a.jsx)(_,{value:"EXEC",children:"Executive (ผู้บริหาร)"}),(0,a.jsx)(_,{value:"CORE",children:"Core Competency"}),(0,a.jsx)(_,{value:"FUNC",children:"Functional Competency"}),(0,a.jsx)(_,{value:"MGT",children:"Managerial Competency"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(F,{htmlFor:"text",className:"text-right",children:"หัวข้อ"}),(0,a.jsx)(R,{id:"text",value:N,onChange:e=>y(e.target.value),className:"col-span-3"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(F,{htmlFor:"weight",className:"text-right",children:"น้ำหนัก (%)"}),(0,a.jsx)(R,{id:"weight",type:"number",value:k,onChange:e=>A(Number(e.target.value)),className:"col-span-3"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(F,{htmlFor:"description",className:"text-right",children:"คำอธิบาย"}),(0,a.jsx)(ts,{id:"description",value:M,onChange:e=>D(e.target.value),className:"col-span-3"})]})]}),(0,a.jsxs)(ez,{children:[(0,a.jsx)(b,{variant:"outline",onClick:()=>o(!1),children:"ยกเลิก"}),(0,a.jsxs)(b,{onClick:P,children:[(0,a.jsx)(tt.Z,{className:"mr-2 h-4 w-4"})," บันทึก"]})]})]})}),(0,a.jsx)(e2,{open:h,onOpenChange:p,onConfirm:$,title:"ยืนยันการลบ",description:"คุณต้องการลบหลักเกณฑ์นี้ใช่หรือไม่? การกระทำนี้ไม่สามารถเรียกคืนได้"})]})},tr=s(8420),tl=s(7954);let ti=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(tl.fC,{ref:t,className:(0,o.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})});ti.displayName=tl.fC.displayName;let tn=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(tl.Ee,{ref:t,className:(0,o.cn)("aspect-square h-full w-full",s),...r})});tn.displayName=tl.Ee.displayName;let td=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(tl.NY,{ref:t,className:(0,o.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});td.displayName=tl.NY.displayName;var to=()=>{let{allUsers:e}=(0,r.b)(),t=Array.from(new Set(e.map(e=>e.dept))).sort(),[s,i]=(0,l.useState)(null),n=t=>e.filter(e=>e.dept===t&&e.isActive);return(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-headline",children:"โครงสร้างองค์กร"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"ภาพรวมบุคลากรแยกตามแผนกและหน่วยงาน"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:t.map(e=>{let t=n(e).length;return(0,a.jsx)(c,{className:"hover:shadow-lg transition-all cursor-pointer border-l-4 border-l-primary hover:-translate-y-1",onClick:()=>i(e),children:(0,a.jsxs)(m,{className:"pb-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("div",{className:"bg-primary/10 p-3 rounded-full",children:(0,a.jsx)(tr.Z,{className:"h-6 w-6 text-primary"})}),(0,a.jsxs)(en,{variant:"secondary",className:"text-xs",children:[t," คน"]})]}),(0,a.jsx)(x,{className:"mt-4 text-xl",children:e}),(0,a.jsx)(h,{children:"คลิกเพื่อดูรายชื่อ"})]})},e)})}),(0,a.jsx)(eM,{open:!!s,onOpenChange:e=>!e&&i(null),children:(0,a.jsxs)(eZ,{className:"max-w-3xl",children:[(0,a.jsxs)(eP,{children:[(0,a.jsxs)(e$,{className:"text-2xl flex items-center gap-2",children:[(0,a.jsx)(tr.Z,{className:"h-6 w-6"})," ",s]}),(0,a.jsxs)(eK,{children:["รายชื่อบุคลากรทั้งหมดในแผนก ",n(s||"").length," คน"]})]}),(0,a.jsx)(z,{className:"h-[60vh] pr-4",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4",children:s&&n(s).map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-4 p-3 rounded-lg border bg-card hover:bg-accent/50 transition-colors",children:[(0,a.jsxs)(ti,{className:"h-12 w-12 border-2 border-background shadow-sm",children:[(0,a.jsx)(tn,{src:e.img}),(0,a.jsx)(td,{children:e.name.charAt(0)})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-bold truncate",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.position}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)(en,{variant:"outline",className:"text-[10px] h-4",children:e.role}),e.email&&(0,a.jsx)("span",{className:"text-[10px] text-muted-foreground truncate",children:e.email})]})]})]},e.internalId))})})]})})]})},tc=s(759);let tm=l.forwardRef((e,t)=>{let{className:s,orientation:r="horizontal",decorative:l=!0,...i}=e;return(0,a.jsx)(tc.f,{ref:t,decorative:l,orientation:r,className:(0,o.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...i})});tm.displayName=tc.f.displayName;var tx=s(1047),th=s(6137),tu=s(91),tp=s(2735),tg=s(3578),tf=s(5621),tj=s(221),tb=()=>{let{systemConfig:e,setSystemConfig:t,logs:s,resetScores:i,backupData:n,exclusions:d,updateSystemConfig:o,addExclusion:p,removeExclusion:g,allUsers:f}=(0,r.b)(),{toast:j}=(0,O.pm)(),[v,N]=l.useState(!1),[y,w]=l.useState(null),[E,k]=l.useState(!1);return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto space-y-10 pb-12 animate-fade-in",children:[(0,a.jsx)("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-4xl font-extrabold font-headline tracking-tight text-slate-900 flex items-center gap-3",children:[(0,a.jsx)(G.Z,{className:"w-10 h-10 text-primary"}),"ตั้งค่าระบบ"]}),(0,a.jsx)("p",{className:"text-slate-500 mt-2 text-lg font-medium",children:"จัดการพารามิเตอร์พื้นฐานและการตั้งค่าความปลอดภัยของระบบประเมิน"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"xl:col-span-2 space-y-8",children:[(0,a.jsxs)(c,{className:"border-0 shadow-xl shadow-slate-200/50 rounded-3xl overflow-hidden ring-1 ring-slate-100 bg-white",children:[(0,a.jsx)(m,{className:"bg-slate-50/50 border-b border-slate-100 pb-8 pt-8",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"p-3 bg-indigo-600 rounded-2xl shadow-lg shadow-indigo-200",children:(0,a.jsx)(tx.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x,{className:"text-xl font-bold font-headline",children:"ช่วงเวลาการประเมิน"}),(0,a.jsx)(h,{children:"กำหนดกรอบเวลาสำหรับรอบการประเมินผลปัจจุบัน"})]})]})}),(0,a.jsxs)(u,{className:"pt-8 space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"start-date",className:"text-sm font-bold text-slate-700",children:"วันที่เริ่มต้น"}),(0,a.jsx)(R,{id:"start-date",type:"date",className:"h-12 rounded-xl bg-slate-50/50 border-slate-200 focus:ring-primary/20 pr-4",value:e.startDate||"",onChange:s=>t({...e,startDate:s.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"end-date",className:"text-sm font-bold text-slate-700",children:"วันที่สิ้นสุด"}),(0,a.jsx)(R,{id:"end-date",type:"date",className:"h-12 rounded-xl bg-slate-50/50 border-slate-200 focus:ring-primary/20",value:e.endDate||"",onChange:s=>t({...e,endDate:s.target.value})})]})]}),(0,a.jsxs)(b,{onClick:()=>o(e),className:"h-12 px-8 rounded-xl shadow-lg shadow-primary/20 hover:scale-[1.02] transition-all",children:[(0,a.jsx)(tt.Z,{className:"w-4 h-4 mr-2"}),"บันทึกช่วงเวลา"]})]})]}),(0,a.jsxs)(c,{className:"border-0 shadow-xl shadow-slate-200/50 rounded-3xl overflow-hidden ring-1 ring-slate-100 bg-white",children:[(0,a.jsx)(m,{className:"bg-slate-50/50 border-b border-slate-100 pb-8 pt-8",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"p-3 bg-blue-600 rounded-2xl shadow-lg shadow-blue-200",children:(0,a.jsx)(ep.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x,{className:"text-xl font-bold font-headline text-slate-800",children:"การแจ้งเตือนและอีเมล"}),(0,a.jsx)(h,{children:"ตั้งค่าการส่งสรุปผลประเมินผ่าน Server"})]})]})}),(0,a.jsxs)(u,{className:"pt-8 space-y-8",children:[(0,a.jsxs)("div",{className:"p-5 bg-blue-50/50 rounded-3xl border border-blue-100/50 flex items-center justify-between group transition-all hover:bg-blue-50",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h4",{className:"font-bold text-blue-900 group-hover:text-primary transition-colors",children:"ส่งสำเนาการประเมินให้ผู้เมิน"}),(0,a.jsx)("p",{className:"text-sm text-blue-700/70",children:"ระบบจะส่งสรุปผลการประเมินเข้าอีเมลของผู้ประเมินโดยอัตโนมัติ"})]}),(0,a.jsx)(eT,{id:"email-copy",className:"data-[state=checked]:bg-blue-600",checked:e.sendEmailCopy,onCheckedChange:t=>{o({...e,sendEmailCopy:t})}})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-slate-800",children:[(0,a.jsx)(th.Z,{className:"w-5 h-5 text-blue-600"}),(0,a.jsx)("h3",{className:"font-bold text-lg",children:"การตั้งค่า SMTP"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,a.jsx)(F,{htmlFor:"smtp-host",className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"SMTP Host"}),(0,a.jsx)(R,{id:"smtp-host",placeholder:"smtp.example.com",className:"h-11 rounded-xl bg-slate-50 focus:bg-white transition-all",value:e.smtpHost||"",onChange:s=>t({...e,smtpHost:s.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"smtp-port",className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"Port"}),(0,a.jsx)(R,{id:"smtp-port",placeholder:"587",className:"h-11 rounded-xl bg-slate-50 focus:bg-white transition-all",value:e.smtpPort||"",onChange:s=>t({...e,smtpPort:s.target.value})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"smtp-user",className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"Username / Email"}),(0,a.jsx)(R,{id:"smtp-user",placeholder:"user@example.com",className:"h-11 rounded-xl bg-slate-50 focus:bg-white transition-all",value:e.smtpUser||"",onChange:s=>t({...e,smtpUser:s.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{htmlFor:"smtp-pass",className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"Password"}),(0,a.jsx)(R,{id:"smtp-pass",type:"password",placeholder:"••••••••",className:"h-11 rounded-xl bg-slate-50 focus:bg-white transition-all",value:e.smtpPass||"",onChange:s=>t({...e,smtpPass:s.target.value})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-end",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F,{className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"Encryption"}),(0,a.jsxs)(C,{value:e.smtpEncryption||"tls",onValueChange:s=>t({...e,smtpEncryption:s}),children:[(0,a.jsx)(I,{className:"h-11 rounded-xl bg-slate-50",children:(0,a.jsx)(S,{})}),(0,a.jsxs)(T,{className:"rounded-xl",children:[(0,a.jsx)(_,{value:"none",children:"None"}),(0,a.jsx)(_,{value:"ssl",children:"SSL (Port 465)"}),(0,a.jsx)(_,{value:"tls",children:"TLS (Port 587)"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(b,{className:"flex-1 h-11 rounded-xl bg-slate-900 shadow-lg shadow-slate-200",onClick:()=>o(e),children:"บันทึก SMTP"}),(0,a.jsx)(b,{variant:"outline",className:"h-11 rounded-xl border-slate-200 text-slate-600 hover:bg-slate-50 px-6",onClick:async()=>{j({title:"Testing...",description:"กำลังทดสอบการเชื่อมต่อ SMTP"});try{let t;let s=await fetch("".concat(Z.CT,"?action=test_smtp"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await s.text();try{t=JSON.parse(a)}catch(e){throw Error("Invalid response format")}t.logs&&w(t.logs),t.success?j({title:"Success",description:"เชื่อมต่อ SMTP สำเร็จ"}):(j({variant:"destructive",title:"Failed",description:t.error||"เชื่อมต่อไม่สำเร็จ"}),t.logs&&k(!0))}catch(e){j({variant:"destructive",title:"Error",description:e.message})}},children:"ทดสอบ"})]})]})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)(c,{className:"border-0 shadow-xl shadow-slate-200/50 rounded-3xl overflow-hidden ring-1 ring-slate-100 bg-white",children:[(0,a.jsx)(m,{className:"bg-slate-50/50 border-b border-slate-100 pb-6 pt-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(tu.Z,{className:"w-5 h-5 text-slate-700"}),(0,a.jsx)(x,{className:"text-lg font-bold font-headline",children:"จัดการข้อมูล"})]})}),(0,a.jsxs)(u,{className:"pt-6 space-y-4",children:[(0,a.jsxs)(b,{onClick:n,variant:"outline",className:"w-full h-11 rounded-xl justify-start gap-3 border-slate-200 hover:bg-slate-50 hover:text-primary transition-all",children:[(0,a.jsx)(tp.Z,{className:"w-4 h-4"}),"สำรองข้อมูล (.json)"]}),(0,a.jsx)(tm,{className:"bg-slate-100"}),(0,a.jsxs)(b,{onClick:()=>N(!0),variant:"ghost",className:"w-full h-11 rounded-xl justify-start gap-3 text-red-500 hover:bg-red-50 hover:text-red-600 font-medium transition-all",children:[(0,a.jsx)(e9.Z,{className:"w-4 h-4"}),"ลบคะแนนทั้งหมด"]})]})]}),(0,a.jsxs)(c,{className:"border-0 shadow-xl shadow-slate-200/50 rounded-3xl overflow-hidden ring-1 ring-slate-100 bg-white",children:[(0,a.jsx)(m,{className:"bg-slate-50/50 border-b border-slate-100 pb-6 pt-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(tg.Z,{className:"w-5 h-5 text-amber-600"}),(0,a.jsx)(x,{className:"text-lg font-bold font-headline",children:"ข้อยกเว้นการประเมิน"})]})}),(0,a.jsxs)(u,{className:"pt-6 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)(R,{placeholder:"Eval ID",className:"h-10 rounded-lg text-sm",id:"ex-eval"}),(0,a.jsx)(R,{placeholder:"Target ID",className:"h-10 rounded-lg text-sm",id:"ex-target"})]}),(0,a.jsx)(R,{placeholder:"เหตุผล",className:"h-10 rounded-lg text-sm",id:"ex-reason"}),(0,a.jsxs)(b,{variant:"outline",className:"w-full h-10 rounded-lg bg-slate-50 text-slate-700",onClick:()=>{let e=parseInt(document.getElementById("ex-eval").value),t=parseInt(document.getElementById("ex-target").value),s=document.getElementById("ex-reason").value;e&&t&&(p(e,t,s),document.getElementById("ex-eval").value="",document.getElementById("ex-target").value="",document.getElementById("ex-reason").value="")},children:[(0,a.jsx)(e6.Z,{className:"w-4 h-4 mr-2"})," เพิ่มกฎข้อยกเว้น"]}),(0,a.jsx)(z,{className:"h-56 w-full rounded-2xl border border-slate-100 bg-slate-50/30 p-2 mt-2",children:d.length>0?d.map((e,t)=>{let s=f.find(t=>t.orgId===e.evaluatorId),r=f.find(t=>t.orgId===e.targetId);return(0,a.jsxs)("div",{className:"p-3 mb-2 bg-white rounded-xl border border-slate-100 shadow-sm flex justify-between items-start group transition-all",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("p",{className:"text-xs font-bold text-slate-800",children:[(null==s?void 0:s.name)||e.evaluatorId," → ",(null==r?void 0:r.name)||e.targetId]}),(0,a.jsx)("p",{className:"text-[11px] text-amber-600 font-medium italic",children:e.reason})]}),(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"h-6 w-6 text-slate-300 hover:text-red-500 rounded-lg",onClick:()=>e.id&&g(e.id),children:(0,a.jsx)(eR.Z,{className:"w-3.5 h-3.5"})})]},t)}):(0,a.jsx)("p",{className:"text-slate-400 text-center py-10 text-xs",children:"ไม่มีรายการข้อยกเว้น"})})]})]}),(0,a.jsxs)(c,{className:"border-0 shadow-xl shadow-slate-200/50 rounded-3xl overflow-hidden ring-1 ring-slate-100 bg-white",children:[(0,a.jsx)(m,{className:"bg-slate-50/50 border-b border-slate-100 pb-6 pt-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(tf.Z,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsx)(x,{className:"text-lg font-bold font-headline",children:"กิจกรรมล่าสุด"})]})}),(0,a.jsx)(u,{className:"pt-6",children:(0,a.jsx)(z,{className:"h-72 w-full rounded-2xl border border-slate-100 bg-slate-50/50 p-4",children:s.length>0?s.slice().reverse().map((e,t)=>(0,a.jsxs)("div",{className:"mb-4 pb-4 border-b border-slate-200/50 last:border-0 last:pb-0",children:[(0,a.jsx)("p",{className:"font-mono text-[9px] text-indigo-500 font-bold mb-1 opacity-70",children:new Date(e.timestamp).toLocaleString("th-TH")}),(0,a.jsxs)("p",{className:"text-sm font-medium text-slate-700 leading-snug",children:[(0,a.jsxs)("span",{className:"text-indigo-600 font-bold",children:[e.user,":"]})," ",e.message]})]},t)):(0,a.jsx)("p",{className:"text-slate-400 text-center py-20 text-xs",children:"ยังไม่มีข้อมูลกิจกรรม"})})})]})]})]}),(0,a.jsx)(e2,{open:v,onOpenChange:N,onConfirm:()=>{i(),N(!1)},title:"ล้างข้อมูลการประเมิน?",description:"คุณแน่ใจหรือไม่ที่จะลบคะแนนและความคิดเห็นทั้งหมด? ข้อมูลนี้ไม่สามารถกู้คืนได้ และควรสำรองข้อมูลก่อนดำเนินการ"}),(0,a.jsx)(eM,{open:E,onOpenChange:k,children:(0,a.jsxs)(eZ,{className:"max-w-3xl max-h-[85vh] rounded-3xl overflow-hidden border-0 shadow-2xl p-0",children:[(0,a.jsx)("div",{className:"bg-slate-900 text-white p-6 border-b border-slate-800",children:(0,a.jsx)(eP,{children:(0,a.jsxs)(e$,{className:"text-2xl font-bold flex items-center gap-3",children:[(0,a.jsx)(tj.Z,{className:"w-6 h-6 text-emerald-400"}),"SMTP Debug Output"]})})}),(0,a.jsx)("div",{className:"p-0 bg-slate-950",children:(0,a.jsx)(z,{className:"h-[500px] w-full p-6",children:(0,a.jsx)("pre",{className:"text-xs font-mono text-emerald-300 whitespace-pre-wrap leading-relaxed",children:y||"Waiting for log data..."})})}),(0,a.jsx)("div",{className:"bg-slate-900 p-4 flex justify-end",children:(0,a.jsx)(b,{className:"bg-emerald-600 hover:bg-emerald-500 rounded-xl px-8 h-12 text-white font-bold",onClick:()=>k(!1),children:"รับทราบ"})})]})})]})},tv=()=>{let{deptAdjustment:e,setDeptAdjustment:t,updateSystemConfig:s,systemConfig:i,allUsers:n}=(0,r.b)(),[d,o]=(0,l.useState)(e),[p,g]=(0,l.useState)(!1),[f,j]=(0,l.useState)(""),{toast:v}=(0,O.pm)();l.useMemo(()=>Array.from(new Set(n.map(e=>e.dept))).filter(e=>e&&!d[e]),[n,d]);let N=async()=>{try{await s({...i,deptAdjustment:d}),t(d),g(!1),v({title:"บันทึกการปรับฐานแล้ว",description:"การปรับฐานคะแนนพื้นฐานได้รับการบันทึกลงฐานข้อมูลแล้ว"})}catch(e){v({variant:"destructive",title:"Error",description:"ไม่สามารถบันทึกข้อมูลได้"})}},y=()=>{f&&(o({...d,[f]:1}),j(""))},w=e=>{let t={...d};delete t[e],o(t)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-headline",children:"ปรับฐานคะแนน"}),(0,a.jsxs)(c,{children:[(0,a.jsx)(m,{children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(x,{children:"ตัวคูณตามแผนกและบทบาท"}),(0,a.jsx)(h,{children:"กำหนดปัจจัยการปรับค่าปกติสำหรับกลุ่มต่างๆ (เช่น 0.90 สำหรับแผนกที่ให้คะแนนสูงเกินจริง)"})]}),(0,a.jsx)("div",{className:"flex gap-2",children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b,{variant:"outline",onClick:()=>{o(e),g(!1)},children:"ยกเลิก"}),(0,a.jsx)(b,{onClick:N,children:"บันทึกการเปลี่ยนแปลง"})]}):(0,a.jsx)(b,{onClick:()=>g(!0),children:"แก้ไขตัวคูณ"})})]})}),(0,a.jsxs)(u,{children:[p&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-indigo-50/50 rounded-xl border border-indigo-100 flex gap-3 items-end",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-1.5",children:[(0,a.jsx)(F,{htmlFor:"new-dept",children:"เพิ่มแผนก"}),(0,a.jsx)(R,{id:"new-dept",placeholder:"ชื่อแผนก...",value:f,onChange:e=>j(e.target.value),onKeyDown:e=>"Enter"===e.key&&y()})]}),(0,a.jsxs)(b,{onClick:y,variant:"secondary",className:"gap-2",children:[(0,a.jsx)(e6.Z,{className:"w-4 h-4"})," เพิ่ม"]})]}),(0,a.jsx)("div",{className:"space-y-1",children:Object.keys(d).length>0?Object.keys(d).map((e,t)=>{var s;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-3 group",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[p&&(0,a.jsx)(b,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>w(e),children:(0,a.jsx)(e9.Z,{className:"w-4 h-4"})}),(0,a.jsx)(F,{htmlFor:"adj-".concat(e),className:"font-medium text-base",children:e})]}),p?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(R,{id:"adj-".concat(e),type:"number",step:"0.01",value:d[e],onChange:t=>o({...d,[e]:parseFloat(t.target.value)||0}),className:"w-24 text-right"}),(0,a.jsx)("span",{className:"text-muted-foreground w-4 text-sm",children:"x"})]}):(0,a.jsxs)("p",{className:"font-mono text-lg bg-gray-50 px-3 py-1 rounded-lg border border-gray-100",children:[null===(s=d[e])||void 0===s?void 0:s.toFixed(2),"x"]})]}),t<Object.keys(d).length-1&&(0,a.jsx)(tm,{className:"bg-gray-100"})]},e)}):(0,a.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:"ไม่พบข้อมูลการปรับฐานคะแนน"})})]})]}),(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-200 p-4 rounded-2xl flex gap-3 text-amber-800",children:[(0,a.jsx)("div",{className:"p-2 bg-amber-200 rounded-full h-fit",children:(0,a.jsx)(e6.Z,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("p",{className:"font-bold mb-1",children:"คำแนะนำการใช้งาน"}),(0,a.jsx)("p",{children:"หากพบว่าสายงานใดมีการให้คะแนนเฉลี่ยสูงกว่าปกติอย่างเห็นได้ชัด (เช่น เฉลี่ย 95%) คุณสามารถกำหนดตัวคูณให้น้อยกว่า 1.0 (เช่น 0.90) เพื่อปรับลดฐานคะแนนของแผนกนั้นให้กลับมาอยู่ในระดับที่สมเหตุสมผลได้ครับ"})]})]})]})};s(3079);var tN=(0,s(2119).$)("5de0e0549821d2c600077758e1d2709de6743c9d"),ty=s(2023),tw=s(6858),tC=()=>{let{allUsers:e,scores:t,comments:s,getCriteriaForUser:i}=(0,r.b)(),{toast:n}=(0,O.pm)(),[d,o]=(0,l.useState)(null),[p,g]=(0,l.useState)(!1),[f,j]=(0,l.useState)(null),v=(0,l.useMemo)(()=>e.filter(e=>e.isActive).map(e=>{let a=t[e.internalId]||{},r=i(e),l=Object.values(a),n=l.length>0?l.reduce((e,t)=>e+t,0)/r.length:0;return{...e,hasComments:!!s[e.internalId],isLowScore:n>0&&n<2.5}}).sort((e,t)=>e.name.localeCompare(t.name)),[e,t,s,i]),N=(0,l.useMemo)(()=>e.find(e=>e.internalId===d)||null,[d,e]),y=(0,l.useMemo)(()=>N?i(N):[],[N,i]),w=(0,l.useMemo)(()=>N&&t[N.internalId]||{},[N,t]),k=async()=>{if(!N){n({variant:"destructive",title:"ไม่ได้เลือกพนักงาน"});return}g(!0),j(null);let e=y.reduce((e,t)=>(e[t.id]=w[t.id]||0,e),{}),t=await tN({position:N.position,department:N.dept,currentScores:e});g(!1),t.success?(j(t.data),n({title:"ข้อเสนอแนะจาก AI พร้อมแล้ว",description:"สร้างคำแนะนำสำหรับ ".concat(N.name," เรียบร้อยแล้ว")})):n({variant:"destructive",title:"เกิดข้อผิดพลาด",description:t.error})};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-headline",children:"เครื่องมือแนะนำคะแนนโดย AI"}),(0,a.jsxs)(c,{children:[(0,a.jsxs)(m,{children:[(0,a.jsx)(x,{children:"วิเคราะห์คะแนนพนักงาน"}),(0,a.jsx)(h,{children:"เลือกพนักงานเพื่อดูคะแนนปัจจุบันและรับคำแนะนำจาก AI สำหรับการปรับคะแนนที่เป็นธรรมตามบทบาทและแผนกของพวกเขา"})]}),(0,a.jsxs)(u,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[(0,a.jsxs)(C,{onValueChange:o,children:[(0,a.jsx)(I,{className:"w-full sm:w-[300px]",children:(0,a.jsx)(S,{placeholder:"เลือกพนักงาน..."})}),(0,a.jsx)(T,{children:(0,a.jsx)(E,{children:v.map(e=>(0,a.jsx)(_,{value:e.internalId,children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full min-w-[280px]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(K.default,{src:e.img,width:24,height:24,className:"rounded-full w-6 h-6 object-cover",alt:e.name}),(0,a.jsx)("span",{children:e.name})]}),(0,a.jsxs)("div",{className:"flex gap-1",children:[e.isLowScore&&(0,a.jsx)(en,{variant:"outline",className:"text-[10px] h-4 px-1 bg-red-50 text-red-600 border-red-100 font-bold",children:"Low"}),e.hasComments&&(0,a.jsx)(en,{variant:"outline",className:"text-[10px] h-4 px-1 bg-amber-50 text-amber-600 border-amber-100 font-bold",children:"Text"})]})]})},e.internalId))})})]}),(0,a.jsxs)(b,{onClick:k,disabled:!d||p,className:"w-full sm:w-auto",children:[p?(0,a.jsx)(eu.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(ty.Z,{className:"mr-2 h-4 w-4"}),"รับคำแนะนำจาก AI"]})]}),N&&(0,a.jsxs)(c,{className:"bg-muted/50",children:[(0,a.jsxs)(m,{children:[(0,a.jsxs)(x,{className:"text-lg",children:["ผลลัพธ์สำหรับ: ",N.name]}),(0,a.jsxs)(h,{children:["ตำแหน่ง: ",N.position," | แผนก: ",N.dept]})]}),(0,a.jsx)(u,{children:(0,a.jsx)("div",{className:"border rounded-md",children:(0,a.jsxs)(ew,{children:[(0,a.jsx)(eC,{children:(0,a.jsxs)(eS,{children:[(0,a.jsx)(eI,{children:"หลักเกณฑ์"}),(0,a.jsx)(eI,{className:"text-center",children:"คะแนนปัจจุบัน"}),(0,a.jsx)(eI,{className:"text-center",children:"คำแนะนำ AI"}),(0,a.jsx)(eI,{className:"text-center",children:"คะแนนที่ปรับ"})]})}),(0,a.jsx)(eE,{children:y.map(e=>{let t=w[e.id]||0,s=f?f[e.id]||0:null,r=null!==s?Math.max(0,Math.min(4,t+s)):null;return(0,a.jsxs)(eS,{children:[(0,a.jsx)(ek,{className:"font-medium",children:e.text}),(0,a.jsx)(ek,{className:"text-center font-bold text-lg",children:t}),(0,a.jsx)(ek,{className:"text-center",children:p?(0,a.jsx)(eu.Z,{className:"h-4 w-4 animate-spin mx-auto"}):null!==s&&0!==s?(0,a.jsx)(en,{variant:s>0?"default":"destructive",className:"bg-green-500",children:s>0?"+".concat(s.toFixed(2)):s.toFixed(2)}):0===s?(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"ไม่มีการเปลี่ยนแปลง"}):(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"-"})}),(0,a.jsxs)(ek,{className:"text-center font-bold text-lg",children:[null!==r&&t!==r&&(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("span",{className:"text-muted-foreground line-through",children:t}),(0,a.jsx)(tw.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-primary",children:r.toFixed(2)})]}),null!==r&&t===r&&(0,a.jsx)("span",{children:t})]})]},e.id)})})]})})})]})]})]})]})};let tE={canManageUsers:"จัดการผู้ใช้",canManageCriteria:"จัดการหลักเกณฑ์",canManageAdjustments:"ปรับฐานคะแนน",canUseAITool:"ใช้เครื่องมือ AI",canManageSystem:"ตั้งค่าระบบ",canViewReport:"ดูรายงานสรุป"};var tS=()=>{let{allUsers:e,setAllUsers:t,addLog:s}=(0,r.b)(),{toast:i}=(0,O.pm)(),[n,d]=(0,l.useState)(""),o=(0,l.useMemo)(()=>e.filter(e=>e.name.toLowerCase().includes(n.toLowerCase())),[e,n]),p=(e,a)=>{t(t=>t.map(t=>{if(t.internalId===e){var s;let e={...t.permissions,[a]:!(null===(s=t.permissions)||void 0===s?void 0:s[a])};return{...t,permissions:e}}return t})),i({title:"อัปเดตสิทธิ์แล้ว"}),s("PERMISSION","Toggled permission ".concat(a," for user ").concat(e))};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-headline",children:"จัดการสิทธิ์การเข้าถึง"}),(0,a.jsxs)(c,{children:[(0,a.jsxs)(m,{children:[(0,a.jsx)(x,{children:"กำหนดสิทธิ์ผู้ใช้"}),(0,a.jsx)(h,{children:'เปิดหรือปิดการเข้าถึงส่วนต่างๆ ของแผงควบคุมสำหรับผู้ใช้แต่ละคน สิทธิ์ "Admin" จะมีผลเหนือกว่าการตั้งค่าทั้งหมด'}),(0,a.jsxs)("div",{className:"relative pt-4",children:[(0,a.jsx)(e5.Z,{className:"absolute left-3 top-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(R,{placeholder:"ค้นหาผู้ใช้...",className:"pl-10",value:n,onChange:e=>d(e.target.value)})]})]}),(0,a.jsx)(u,{children:(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(ew,{children:[(0,a.jsx)(eC,{children:(0,a.jsxs)(eS,{children:[(0,a.jsx)(eI,{children:"ผู้ใช้"}),Object.values(tE).map(e=>(0,a.jsx)(eI,{className:"text-center",children:e},e))]})}),(0,a.jsx)(eE,{children:o.map(e=>(0,a.jsxs)(eS,{className:e.isAdmin?"bg-primary/10":"",children:[(0,a.jsx)(ek,{children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(K.default,{src:e.img,width:40,height:40,className:"w-10 h-10 rounded-full",alt:e.name}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:e.position})]})]})}),Object.keys(tE).map(t=>{var s;return(0,a.jsx)(ek,{className:"text-center",children:(0,a.jsx)(eT,{checked:e.isAdmin||(null===(s=e.permissions)||void 0===s?void 0:s[t])||!1,onCheckedChange:()=>p(e.internalId,t),disabled:e.isAdmin,"aria-label":"Toggle ".concat(t," for ").concat(e.name)})},t)})]},e.internalId))})]})})})]})]})},tI=()=>{let{goBack:e,user:t}=(0,r.b)(),[s,i]=(0,l.useState)((null==t?void 0:t.isAdmin)?"users":"adjustments");return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 flex flex-col md:flex-row animate-fade-in font-sans",children:[(0,a.jsx)(ey,{activeTab:s,setActiveTab:i,onBack:e,user:t}),(0,a.jsx)("main",{className:"flex-1 p-4 md:p-6 overflow-y-auto max-h-screen",children:(0,a.jsx)("div",{className:"bg-white/60 backdrop-blur-sm rounded-3xl shadow-xl shadow-indigo-100 border border-white h-full overflow-y-auto p-6 md:p-8 animate-in slide-in-from-right-4 duration-500",children:(()=>{switch(s){case"users":return(null==t?void 0:t.isAdmin)?(0,a.jsx)(te,{}):null;case"criteria":return(null==t?void 0:t.isAdmin)||(null==t?void 0:t.canViewReport)?(0,a.jsx)(ta,{}):null;case"org":return(0,a.jsx)(to,{});case"adjustments":return(0,a.jsx)(tv,{});case"ai-tool":return(0,a.jsx)(tC,{});case"system":return(null==t?void 0:t.isAdmin)?(0,a.jsx)(tb,{}):null;case"permissions":return(null==t?void 0:t.isAdmin)?(0,a.jsx)(tS,{}):null;default:return(null==t?void 0:t.isAdmin)?(0,a.jsx)(tb,{}):(0,a.jsx)(tv,{})}})()})})]})},tk=s(2465),tA=s(519);let tT=tk.fC,t_=tk.xz;tk.ZA,tk.Uv,tk.Tr,tk.Ee,l.forwardRef((e,t)=>{let{className:s,inset:r,children:l,...i}=e;return(0,a.jsxs)(tk.fF,{ref:t,className:(0,o.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...i,children:[l,(0,a.jsx)(d.Z,{className:"ml-auto"})]})}).displayName=tk.fF.displayName,l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(tk.tu,{ref:t,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}).displayName=tk.tu.displayName;let tR=l.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...l}=e;return(0,a.jsx)(tk.Uv,{children:(0,a.jsx)(tk.VY,{ref:t,sideOffset:r,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})})});tR.displayName=tk.VY.displayName;let tM=l.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(tk.ck,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...l})});tM.displayName=tk.ck.displayName,l.forwardRef((e,t)=>{let{className:s,children:r,checked:l,...i}=e;return(0,a.jsxs)(tk.oC,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:l,...i,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(tk.wU,{children:(0,a.jsx)(w.Z,{className:"h-4 w-4"})})}),r]})}).displayName=tk.oC.displayName,l.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(tk.Rk,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(tk.wU,{children:(0,a.jsx)(tA.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=tk.Rk.displayName,l.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(tk.__,{ref:t,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...l})}).displayName=tk.__.displayName,l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(tk.Z0,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=tk.Z0.displayName;var tD=()=>{var e;let{user:t,currentGroup:s,goBack:i,scores:n,updateScore:d,setScores:c,filterType:m,getCriteriaForUser:x,exclusions:h,allUsers:u,comments:p,updateComment:g,systemConfig:f}=(0,r.b)(),{toast:j}=(0,O.pm)(),v=(0,l.useMemo)(()=>{let e=new Date().toISOString().split("T")[0];return e<f.startDate||e>f.endDate},[f]),y=(0,l.useMemo)(()=>t&&s?(0,H.EQ)(t,u,h).filter(e=>("role"===m?e.role:e.salaryGroup)===s):[],[t,s,u,h,m]),w=(0,l.useMemo)(()=>0===y.length?[]:x(y[0]),[y,x]),C=(0,l.useMemo)(()=>{let e={};return Z.Ys.forEach(t=>e[t.id]=[]),w.forEach(t=>{let s=t.category;e[s]&&e[s].push(t)}),e},[w]),E=(e,t)=>{if(t){let t="scale-110 shadow-lg";switch(e){case 1:return"bg-red-500 hover:bg-red-500/90 text-white border-2 border-red-600 ".concat(t);case 2:return"bg-orange-400 hover:bg-orange-400/90 text-white border-2 border-orange-500 ".concat(t);case 3:return"bg-yellow-500 hover:bg-yellow-500/90 text-white border-2 border-yellow-600 ".concat(t);case 4:return"bg-emerald-600 hover:bg-emerald-600/90 text-white border-2 border-emerald-700 ".concat(t)}}return"bg-muted hover:bg-secondary text-muted-foreground border-2 border-transparent"},S=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;if(v){j({variant:"destructive",title:"ไม่อนุญาต",description:"อยู่นอกช่วงเวลาการประเมิน"});return}let t=0;for(let a of y)for(let r of x(a)){var s;!(null===(s=n[a.internalId])||void 0===s?void 0:s[r.id])&&(await d(a.internalId,r.id,e),t++)}t>0?j({title:"บันทึกสำเร็จ",description:"ใส่คะแนน ".concat(e," ให้กับ ").concat(t," ช่องที่ว่างแล้ว")}):j({title:"ไม่มีการเปลี่ยนแปลง",description:"ทุกช่องมีคะแนนอยู่แล้ว"})};return s&&0!==y.length?(0,a.jsxs)("div",{className:"h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 flex-col hidden md:flex animate-fade-in font-sans",children:[(0,a.jsxs)("header",{className:"bg-white/80 backdrop-blur-md shadow-sm px-6 py-4 flex items-center gap-4 flex-shrink-0 sticky top-0 z-30 border-b border-white/20 transition-all",children:[(0,a.jsx)(b,{onClick:i,variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full hover:bg-gray-100",children:(0,a.jsx)(ev.Z,{className:"h-5 w-5 text-gray-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-xl font-bold font-headline text-gray-800 tracking-tight flex items-center gap-2",children:["กำลังประเมินระดับ: ",(0,a.jsx)("span",{className:"bg-primary/10 text-primary px-2 py-0.5 rounded-md",children:"role"===m?Z.Sx[s]:s})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 font-medium mt-0.5",children:["ประเภท: ",null===(e=y[0])||void 0===e?void 0:e.type]})]}),(0,a.jsxs)("div",{className:"ml-auto flex gap-3",children:[(0,a.jsxs)(tT,{children:[(0,a.jsx)(t_,{asChild:!0,children:(0,a.jsxs)(b,{variant:"outline",disabled:v,className:"rounded-xl h-10 border-indigo-200 text-indigo-700 hover:bg-indigo-50 hover:text-indigo-800 gap-2",children:["ใส่คะแนนอัตโนมัติ (ช่องว่าง) ",(0,a.jsx)(N.Z,{className:"h-4 w-4"})]})}),(0,a.jsxs)(tR,{align:"end",className:"rounded-xl shadow-xl shadow-indigo-100 border-indigo-100 bg-white/90 backdrop-blur-sm p-1",children:[(0,a.jsx)(tM,{onClick:()=>S(4),className:"rounded-lg cursor-pointer hover:bg-emerald-50 hover:text-emerald-700 font-medium",children:"ใส่ 4 คะแนน (ดีมาก)"}),(0,a.jsx)(tM,{onClick:()=>S(3),className:"rounded-lg cursor-pointer hover:bg-blue-50 hover:text-blue-700 font-medium",children:"ใส่ 3 คะแนน (ดี)"}),(0,a.jsx)(tM,{onClick:()=>S(2),className:"rounded-lg cursor-pointer hover:bg-orange-50 hover:text-orange-700 font-medium",children:"ใส่ 2 คะแนน (พอใช้)"}),(0,a.jsx)(tM,{onClick:()=>S(1),className:"rounded-lg cursor-pointer hover:bg-red-50 hover:text-red-700 font-medium",children:"ใส่ 1 คะแนน (ปรับปรุง)"})]})]}),(0,a.jsxs)(b,{onClick:()=>{if(v){j({variant:"destructive",title:"บันทึกไม่ได้",description:"อยู่นอกช่วงเวลาการประเมิน"});return}j({title:"บันทึกสำเร็จ",description:"ข้อมูลล่าสุดถูกต้องแล้ว (บันทึกอัตโนมัติ)"}),i()},className:"gap-2 rounded-xl h-10 shadow-lg shadow-primary/20 bg-gradient-to-r from-primary to-indigo-600 hover:from-primary/90 hover:to-indigo-700",disabled:v,children:[(0,a.jsx)(tt.Z,{className:"h-4 w-4"})," เสร็จสิ้น"]})]})]}),(0,a.jsx)("main",{className:"flex-1 overflow-hidden p-4 md:p-6",children:(0,a.jsx)(es,{children:(0,a.jsx)("div",{className:"bg-white/60 backdrop-blur-sm rounded-3xl shadow-xl shadow-indigo-100 border border-white h-full overflow-hidden ring-1 ring-gray-950/5 flex flex-col",children:(0,a.jsx)("div",{className:"overflow-auto flex-1 custom-scrollbar relative",children:(0,a.jsxs)("table",{className:"w-full border-separate border-spacing-0 min-w-[1200px]",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"shadow-sm",children:[(0,a.jsx)("th",{className:"p-6 text-left sticky top-0 left-0 bg-gray-50/95 backdrop-blur-md z-[100] border-r border-b border-gray-200 w-[320px] min-w-[320px] shadow-[4px_0_8px_-2px_rgba(0,0,0,0.05)] h-[120px] align-middle",children:(0,a.jsx)("span",{className:"text-base font-bold text-gray-800",children:"หัวข้อการประเมิน"})}),y.map(e=>(0,a.jsx)("th",{className:"p-4 min-w-[200px] text-center align-top h-[120px] border-r border-b border-gray-200 sticky top-0 bg-gray-50/95 backdrop-blur-md z-[90]",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(K.default,{src:e.img,width:56,height:56,alt:e.name,className:"w-14 h-14 rounded-full border-4 border-white shadow-md object-cover bg-gray-100"}),(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 bg-white rounded-full p-0.5 shadow-sm",children:(0,a.jsx)("span",{className:"flex h-4 w-4 rounded-full bg-emerald-500 border-2 border-white"})})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("p",{className:"font-bold text-gray-800 text-sm truncate max-w-[160px]",children:e.name}),(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{asChild:!0,children:(0,a.jsx)("p",{className:"text-[10px] text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full truncate max-w-[150px] cursor-help mt-1",children:(null==t?void 0:t.dept)!==e.dept?"".concat(e.position," - ").concat(e.dept):e.position})}),(0,a.jsx)(el,{children:(0,a.jsxs)("p",{children:[e.position," - ",e.dept]})})]})]})]})},e.internalId))]})}),(0,a.jsxs)("tbody",{children:[Z.Ys.map(e=>{let t=C[e.id];return(null==t?void 0:t.length)?(0,a.jsxs)(l.Fragment,{children:[(0,a.jsx)("tr",{className:"bg-gray-50/50",children:(0,a.jsx)("td",{colSpan:y.length+1,className:(0,o.cn)("px-6 py-3 text-xs font-bold uppercase tracking-wider sticky left-0 z-[40] border-r border-b border-gray-200 shadow-[4px_0_8px_-2px_rgba(0,0,0,0.05)]",e.color.replace("bg-","bg-opacity-10 text-").replace("-100","-700")),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:(0,o.cn)("w-2 h-2 rounded-full",e.color.replace("bg-","bg-"))}),e.name]})})}),t.map(e=>(0,a.jsxs)("tr",{className:"group hover:bg-indigo-100 transition-colors",children:[(0,a.jsx)("td",{className:"p-6 text-sm font-medium sticky left-0 bg-white border-r border-b border-gray-100 z-[20] w-[320px] min-w-[320px] shadow-[4px_0_8px_-2px_rgba(0,0,0,0.05)]",children:(0,a.jsxs)("div",{className:"flex justify-between items-start gap-2",children:[(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{asChild:!0,children:(0,a.jsx)("span",{className:"cursor-help text-gray-700 group-hover:text-indigo-600 transition-colors leading-relaxed block",children:e.text})}),(0,a.jsx)(el,{side:"right",className:"max-w-md p-4 text-sm bg-gray-900 text-white border-0 shadow-xl",children:(0,a.jsx)("p",{children:e.description})})]}),(0,a.jsxs)(en,{variant:"secondary",className:"ml-1 shrink-0 bg-gray-100 text-gray-500 font-mono text-[10px]",children:["x",e.weight]})]})}),y.map(t=>(0,a.jsx)("td",{className:"p-3 text-center align-middle border-r border-b border-gray-100",children:(0,a.jsx)("div",{className:"flex justify-center gap-1",children:[1,2,3,4].map(s=>{var r;return(0,a.jsx)(b,{onClick:()=>d(t.internalId,e.id,s),variant:"ghost",size:"icon",className:(0,o.cn)("w-10 h-10 text-sm font-bold rounded-xl transition-all duration-200 border border-transparent",E(s,(null===(r=n[t.internalId])||void 0===r?void 0:r[e.id])===s)),children:s},s)})})},"".concat(t.internalId,"-").concat(e.id)))]},e.id))]},e.id):null}),(0,a.jsxs)("tr",{className:"bg-gray-50 font-bold",children:[(0,a.jsx)("td",{className:"p-6 text-sm sticky left-0 bg-gray-50 border-r border-b border-gray-200 z-[20] w-[320px] min-w-[320px] shadow-[4px_0_8px_-2px_rgba(0,0,0,0.05)]",children:(0,a.jsx)("span",{className:"text-gray-800",children:"คะแนนรวม (ปรับตามน้ำหนัก)"})}),y.map(e=>(0,a.jsx)("td",{className:"p-4 text-center border-r border-b border-gray-200",children:(0,a.jsxs)("span",{className:"text-xl text-primary",children:[(0,H.tf)(e.internalId,n,w).toFixed(2),"%"]})},"total-".concat(e.internalId)))]}),(0,a.jsxs)("tr",{className:"bg-white",children:[(0,a.jsx)("td",{className:"p-6 text-sm font-medium sticky left-0 bg-white border-r border-b border-gray-200 z-[20] w-[320px] min-w-[320px] shadow-[4px_0_8px_-2px_rgba(0,0,0,0.05)] align-top pt-8",children:(0,a.jsx)("span",{className:"text-gray-700",children:"ความคิดเห็นผู้ประเมิน"})}),y.map(e=>(0,a.jsx)("td",{className:"p-4 align-top border-r border-b border-gray-200",children:(0,a.jsx)(ts,{placeholder:"ความคิดเห็นสำหรับ ".concat(e.name,"..."),className:"min-h-[100px] text-sm bg-gray-50/50 border-gray-200 rounded-xl focus:ring-primary/20 focus:border-primary resize-none placeholder:text-gray-400 font-sans",value:"string"==typeof p[e.internalId]?p[e.internalId]:"",onChange:t=>g(e.internalId,t.target.value)})},"comment-".concat(e.internalId)))]})]})]})})})})})]}):null},tF=()=>{let{currentPerson:e,goBack:t,scores:s,updateScore:i,getCriteriaForUser:n,comments:d,updateComment:p,systemConfig:g,user:f}=(0,r.b)(),{toast:j}=(0,O.pm)(),[v,N]=l.useState({}),[y,w]=l.useState(!1),[C,E]=l.useState(!1);l.useEffect(()=>{e&&s[e.internalId]&&N(s[e.internalId])},[e,s]);let S=(0,l.useMemo)(()=>e?n(e):[],[e,n]),I=(0,l.useMemo)(()=>{let e={};return Z.Ys.forEach(t=>e[t.id]=[]),S.forEach(t=>{let s=t.category;e[s]&&e[s].push(t)}),e},[S]),k=(0,l.useMemo)(()=>{let e=new Date().toISOString().split("T")[0];return e<g.startDate||e>g.endDate},[g]);if(!e)return null;let A=async()=>{let s=S.filter(e=>!v[e.id]);if(s.length>0){j({title:"ประเมินไม่ครบถ้วน",description:"กรุณาให้คะแนนให้ครบทุกข้อ (ขาด ".concat(s.length," ข้อ)"),variant:"destructive"});return}w(!0);try{let s=Object.entries(v).map(t=>{let[s,a]=t;return i(e.internalId,s,a)});await Promise.all(s),j({title:"บันทึกการประเมินแล้ว",description:"การประเมินสำหรับ ".concat(e.name," ถูกบันทึกแล้ว")}),t()}catch(e){j({title:"บันทึกไม่สำเร็จ",description:"เกิดข้อผิดพลาดในการบันทึกข้อมูล กรุณาลองใหม่อีกครั้ง",variant:"destructive"})}finally{w(!1)}},T=(e,t)=>{if(t){let t="scale-105 shadow-md";switch(e){case 1:return"bg-red-500 hover:bg-red-500/90 text-white ".concat(t);case 2:return"bg-orange-400 hover:bg-orange-400/90 text-white ".concat(t);case 3:return"bg-yellow-500 hover:bg-yellow-500/90 text-white ".concat(t);case 4:return"bg-emerald-600 hover:bg-emerald-600/90 text-white ".concat(t)}}return"bg-muted hover:bg-secondary"};return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 flex flex-col animate-fade-in font-sans",children:[(0,a.jsxs)("header",{className:"bg-white/80 backdrop-blur-md shadow-sm px-4 py-3 flex items-center gap-3 sticky top-0 z-20 border-b border-white/20 transition-all",children:[(0,a.jsx)(b,{onClick:t,variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full hover:bg-gray-100",children:(0,a.jsx)(ev.Z,{className:"h-5 w-5 text-gray-700"})}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(K.default,{src:e.img,width:44,height:44,className:"w-11 h-11 rounded-full border-2 border-white shadow-md bg-muted object-cover",alt:e.name}),(0,a.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-500 border-2 border-white rounded-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-bold font-headline text-lg text-gray-800 leading-tight",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-gray-500 font-medium",children:e.position})]})]})]}),(0,a.jsxs)("main",{className:"flex-1 p-4 space-y-5 max-w-2xl w-full mx-auto pb-32",children:[k&&(0,a.jsx)(c,{className:"bg-yellow-50 border-yellow-200 text-yellow-800 shadow-sm rounded-2xl",children:(0,a.jsxs)(m,{className:"flex-row items-center gap-3 space-y-0 p-4",children:[(0,a.jsx)("div",{className:"p-2 bg-yellow-100 rounded-full",children:(0,a.jsx)(J.Z,{className:"h-5 w-5 text-yellow-700"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x,{className:"text-sm font-bold",children:"นอกช่วงเวลาการประเมิน"}),(0,a.jsx)(h,{className:"text-yellow-700 text-xs",children:"ไม่สามารถแก้ไขหรือบันทึกข้อมูลได้"})]})]})}),(0,a.jsx)(es,{children:Z.Ys.map(e=>{let t=I[e.id];return t&&0!==t.length?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:(0,o.cn)("px-4 py-2 rounded-xl text-xs font-bold uppercase tracking-widest flex items-center gap-2 mb-2",e.color),children:[(0,a.jsx)("span",{className:"w-2 h-2 rounded-full bg-current opacity-50"}),e.name]}),t.map((e,t)=>(0,a.jsxs)(c,{className:"shadow-lg shadow-indigo-100 border-0 rounded-3xl overflow-hidden bg-white/80 backdrop-blur-sm animate-fade-in-up",children:[(0,a.jsx)(m,{className:"pb-3 bg-gradient-to-r from-gray-50 to-white border-b border-gray-100",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-indigo-100 text-indigo-700 text-xs font-bold mt-0.5",children:S.indexOf(e)+1}),(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{asChild:!0,children:(0,a.jsx)(x,{className:"text-base font-bold text-gray-800 cursor-help leading-snug",children:e.text})}),(0,a.jsx)(el,{side:"bottom",className:"max-w-xs p-3 bg-gray-900 text-white border-0",children:(0,a.jsx)("p",{children:e.description})})]})]}),(0,a.jsxs)("span",{className:"text-xs font-bold bg-gray-100 text-gray-500 px-2 py-1 rounded-md",children:["WT: ",e.weight]})]})}),(0,a.jsxs)(u,{className:"pt-4 px-4 pb-5",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-4 px-1",children:e.description}),(0,a.jsx)("div",{className:"grid grid-cols-4 gap-3",children:[1,2,3,4].map(t=>(0,a.jsx)(b,{onClick:()=>N(s=>({...s,[e.id]:t})),variant:"outline",disabled:k||y,className:(0,o.cn)("py-6 text-xl font-bold transition-all duration-200 h-14 rounded-2xl border-2",T(t,(null==v?void 0:v[e.id])===t)),children:t},t))})]})]},e.id))]},e.id):null})}),(0,a.jsxs)(c,{className:"shadow-lg shadow-indigo-100 border-0 rounded-3xl overflow-hidden bg-white",children:[(0,a.jsx)(m,{className:"pb-2",children:(0,a.jsxs)(x,{className:"text-base font-bold flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-1 h-5 bg-primary rounded-full"}),"ความคิดเห็นโดยรวม"]})}),(0,a.jsx)(u,{className:"p-4 pt-1",children:(0,a.jsx)(ts,{className:"min-h-[120px] text-base bg-gray-50 border-gray-100 rounded-2xl focus:ring-primary/20 focus:border-primary resize-none p-4",placeholder:"ระบุความคิดเห็นเพิ่มเติมสำหรับ ".concat(e.name,"..."),value:"string"==typeof d[e.internalId]?d[e.internalId]:"",onChange:t=>p(e.internalId,t.target.value),disabled:k})})]})]}),(0,a.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-lg p-4 border-t border-gray-100 shadow-[0_-4px_20px_-5px_rgba(0,0,0,0.1)] z-40",children:(0,a.jsxs)(b,{onClick:A,size:"lg",className:"w-full max-w-2xl mx-auto flex gap-2 h-14 rounded-2xl text-lg font-bold shadow-xl shadow-indigo-200 bg-gradient-to-r from-primary to-indigo-600 hover:scale-[1.01] active:scale-[0.98] transition-all",disabled:k||y,children:[y?(0,a.jsx)("span",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white/80"}):(0,a.jsx)(tt.Z,{className:"h-5 w-5"})," บันทึกการประเมิน"]})})]})},tO=s(8842),tZ=s(265),tP=s(5051),tz=s(1649),t$=()=>{let{goBack:e,deptAdjustment:t,getCriteriaForUser:s,allUsers:i,fetchReportData:n,user:d,exclusions:o}=(0,r.b)(),[p,g]=(0,l.useState)(!0),[f,j]=(0,l.useState)(""),[v,N]=(0,l.useState)({key:"role",direction:"ascending"}),[y,w]=(0,l.useState)(null),[C,E]=(0,l.useState)({}),[S,I]=(0,l.useState)({}),[k,A]=(0,l.useState)({}),[T,_]=(0,l.useState)({}),[M,D]=(0,l.useState)(!0);l.useEffect(()=>{(async()=>{D(!0);let e=await n({raw:!0});e&&(E(e.scores||{}),I(e.all_scores||{}),A(e.comments||{}),_(e.evaluator_counts||{})),D(!1)})()},[]);let O=(0,l.useMemo)(()=>i.filter(e=>e.role!==Z.K$.COMMITTEE&&e.isActive).map(e=>{let a=s(e),r=(0,H.jl)(e,S,i,a,Z.xm,Z.ys,o),l=t[e.dept]||1,n=p?Math.min(100,r*l):r,c=(0,H._0)(n),m=k[e.internalId]||"-",x=a.length>0&&a.every(t=>{var s;return null===(s=C[e.internalId])||void 0===s?void 0:s[t.id]}),h=(null==d?void 0:d.internalId)===e.internalId,u=0;return i.forEach(t=>{if(!t.isActive||t.internalId===e.internalId)return;if(t.role===Z.K$.COMMITTEE&&[Z.K$.MANAGER,Z.K$.ASST,Z.K$.HEAD].includes(e.role)&&t.orgId!==e.orgId){!(0,H.p_)(t.orgId,e.orgId,o)&&u++;return}let s=e.parentInternalId,a=!1;for(;s;){if(s===t.internalId){a=!0;break}let e=i.find(e=>e.internalId===s);s=e?e.parentInternalId:null}if(a){!(0,H.p_)(t.orgId,e.orgId,o)&&u++;return}s=t.parentInternalId;let r=!1;for(;s;){if(s===e.internalId){r=!0;break}let t=i.find(e=>e.internalId===s);s=t?t.parentInternalId:null}if(r){!(0,H.p_)(t.orgId,e.orgId,o)&&u++;return}}),{...e,role:e.role,finalScore:n,levelLabel:c.label,levelColor:c.color,comment:h?"HIDDEN_SELF":m,isDone:x,evaluatorCount:T[e.internalId]||0,totalEvaluators:u}}),[i,C,p,t,s,k,T,o]);(0,l.useMemo)(()=>{let e={};i.forEach(t=>{if(t.role===Z.K$.COMMITTEE||!t.isActive)return;let a=s(t),r=(0,H.tf)(t.internalId,C,a);e[t.dept]||(e[t.dept]={sum:0,count:0}),e[t.dept].sum+=r,e[t.dept].count+=1});let t={};return Object.keys(e).forEach(s=>{t[s]=e[s].sum/e[s].count}),t},[i,C,s]);let P=(0,l.useMemo)(()=>{let e=O.filter(e=>e.name.toLowerCase().includes(f.toLowerCase())),t={MANAGER:1,ASST:2,HEAD:3,STAFF:4,COMMITTEE:5};return e.sort((e,s)=>{let a=v.key||"role",r=(e,s,a)=>{var r,l;let i=null!==(r=e[a])&&void 0!==r?r:"",n=null!==(l=s[a])&&void 0!==l?l:"";if("role"===a&&(i=t[e.role]||99,n=t[s.role]||99),"salaryGroup"===a){let t={ไม่จัดกลุ่ม:0,"ไม่เกิน 20,000":1,"เกิน 20,000":2,"เกิน 30,000":3,"เกิน 40,000":4,"เกิน 50,000":5,"เกิน 100,000":6};i=t[e.salaryGroup]||0,n=t[s.salaryGroup]||0}return"string"==typeof i&&"string"==typeof n?i.localeCompare(n):i<n?-1:i>n?1:0},l=r(e,s,a);return"descending"===v.direction&&(l*=-1),0===l&&"role"!==a&&(l=r(e,s,"role")),0===l&&"name"!==a&&(l=r(e,s,"name")),l}),e},[O,f,v]),z=e=>{let t="ascending";v.key===e&&"ascending"===v.direction&&(t="descending"),N({key:e,direction:t})},$=e=>{let{column:t}=e;return v.key!==t?(0,a.jsx)(tO.Z,{className:"ml-2 h-4 w-4 text-muted-foreground/50 inline"}):"ascending"===v.direction?(0,a.jsx)(tZ.Z,{className:"ml-2 h-4 w-4 text-foreground inline"}):(0,a.jsx)(tP.Z,{className:"ml-2 h-4 w-4 text-foreground inline"})},V=e=>{w(e)};return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 flex flex-col animate-fade-in font-sans",children:[(0,a.jsxs)("header",{className:"bg-white/80 backdrop-blur-md shadow-sm px-6 py-4 flex items-center gap-4 sticky top-0 z-20 border-b border-white/20 transition-all",children:[(0,a.jsx)(b,{onClick:e,variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full hover:bg-gray-100",children:(0,a.jsx)(ev.Z,{className:"h-5 w-5 text-gray-600"})}),(0,a.jsxs)("h1",{className:"text-xl font-bold font-headline text-gray-800 tracking-tight flex items-center gap-2",children:[(0,a.jsx)("span",{className:"bg-primary/10 text-primary p-2 rounded-xl",children:(0,a.jsx)(tz.Z,{className:"w-5 h-5"})}),"รายงานสรุปผลการประเมิน"]}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-white/50 px-3 py-1.5 rounded-full border border-gray-200",children:[(0,a.jsx)(eT,{id:"normalization-switch",checked:p,onCheckedChange:g}),(0,a.jsx)(F,{htmlFor:"normalization-switch",className:"text-sm cursor-pointer",children:"ปรับฐานคะแนน"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(b,{onClick:()=>{let e=["ชื่อ-นามสกุล","อีเมล","ตำแหน่ง","แผนก","กลุ่มเงินเดือน","คะแนนรวม (%)","ประเมินแล้ว (คน)","ผู้ประเมินทั้งหมด (คน)","ระดับ","ความเห็น",...Z.wA.map(e=>"".concat(e.id," ").concat(e.text))].join(",")+"\n",t=P.map(e=>{let t=[e.name,e.email||"",e.position,e.dept,e.salaryGroup,e.finalScore.toFixed(2),e.evaluatorCount||0,e.totalEvaluators||0,e.levelLabel],s=Z.wA.map(t=>{var s;return(null===(s=C[e.internalId])||void 0===s?void 0:s[t.id])||""}),a="";return a="HIDDEN_SELF"===e.comment?"สงวนสิทธิ์การเข้าถึง (Self-Evaluation Policy)":Array.isArray(e.comment)?e.comment.map(e=>"[".concat(e.evaluator,"]: ").concat(e.comment)).join("\n"):e.comment,[...t,...s,'"'.concat(a.replace(/"/g,'""'),'"')].join(",")}).join("\n");(0,H.EZ)("evaluation_detailed_".concat(new Date().toISOString().slice(0,10),".csv"),e+t)},variant:"outline",className:"rounded-xl h-10 border-indigo-200 text-indigo-700 hover:bg-indigo-50 hover:text-indigo-800",children:[(0,a.jsx)(tz.Z,{className:"mr-2 h-4 w-4"})," ส่งออกละเอียด"]}),(0,a.jsxs)(b,{onClick:()=>{let e=P.map(e=>{let t="";t="HIDDEN_SELF"===e.comment?"สงวนสิทธิ์การเข้าถึง (Self-Evaluation Policy)":Array.isArray(e.comment)?e.comment.map(e=>"[".concat(e.evaluator,"]: ").concat(e.comment)).join(" | "):e.comment;let s='"'.concat(t.replace(/"/g,'""'),'"');return[e.name,e.email||"",e.position,e.dept,e.salaryGroup,e.finalScore.toFixed(2),e.evaluatorCount||0,e.totalEvaluators||0,e.levelLabel,s].join(",")}).join("\n");(0,H.EZ)("evaluation_summary_".concat(new Date().toISOString().slice(0,10),".csv"),"ชื่อ-นามสกุล,อีเมล,ตำแหน่ง,แผนก,กลุ่มเงินเดือน,คะแนนรวม (%),ประเมินแล้ว (คน),ผู้ประเมินทั้งหมด (คน),ระดับ,ความเห็น\n"+e)},className:"rounded-xl h-10 shadow-lg shadow-primary/20 bg-gradient-to-r from-primary to-indigo-600 hover:from-primary/90 hover:to-indigo-700",children:[(0,a.jsx)(tp.Z,{className:"mr-2 h-4 w-4"})," ส่งออกเป็น CSV"]})]})]})]}),(0,a.jsx)("main",{className:"p-4 md:p-6 flex-1",children:(0,a.jsxs)(c,{className:"bg-white/60 backdrop-blur-sm shadow-xl shadow-indigo-100 border border-white rounded-3xl overflow-hidden ring-1 ring-gray-950/5",children:[(0,a.jsx)(m,{className:"border-b border-gray-100 bg-white/50 pb-6",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(x,{className:"text-xl font-bold text-gray-800",children:"ผลการประเมินทั้งหมด"}),(0,a.jsx)(h,{className:"text-gray-500 mt-1",children:"สรุปผลการประเมินของพนักงานทั้งหมด (ไม่รวมคณะกรรมการ)"})]}),(0,a.jsxs)("div",{className:"relative w-full md:w-72",children:[(0,a.jsx)(e5.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(R,{placeholder:"ค้นหาตามชื่อ...",className:"pl-10 h-11 rounded-xl bg-white border-gray-200 focus:border-indigo-300 focus:ring-indigo-100",value:f,onChange:e=>j(e.target.value)})]})]})}),(0,a.jsx)(u,{className:"p-0",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ew,{children:[(0,a.jsx)(eC,{className:"bg-gray-50/80",children:(0,a.jsxs)(eS,{className:"border-b border-gray-200 hover:bg-transparent",children:[(0,a.jsxs)(eI,{onClick:()=>z("dept"),className:"cursor-pointer hover:bg-gray-50 transition-colors py-4",children:["แผนก ",(0,a.jsx)($,{column:"dept"})]}),(0,a.jsxs)(eI,{onClick:()=>z("salaryGroup"),className:"cursor-pointer hover:bg-gray-100/80 h-12 font-semibold text-gray-600 transition-colors",children:["กลุ่มเงินเดือน ",(0,a.jsx)($,{column:"salaryGroup"})]}),(0,a.jsxs)(eI,{onClick:()=>z("finalScore"),className:"cursor-pointer hover:bg-gray-100/80 h-12 text-center font-semibold text-gray-600 transition-colors",children:["คะแนนรวม ",(0,a.jsx)($,{column:"finalScore"})]}),(0,a.jsx)(eI,{className:"text-center font-semibold text-gray-600 h-12",children:"ระดับ"}),(0,a.jsx)(eI,{className:"font-semibold text-gray-600 h-12",children:"ความคิดเห็น"})]})}),(0,a.jsx)(eE,{children:P.map(e=>(0,a.jsxs)(eS,{className:"cursor-pointer hover:bg-indigo-50/40 transition-all border-b border-gray-50 last:border-0 group",onClick:()=>V(e),children:[(0,a.jsx)(ek,{className:"pl-6 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(K.default,{src:e.img,width:44,height:44,className:"w-11 h-11 rounded-full border-2 border-white shadow-sm bg-gray-100 object-cover",alt:e.name}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-gray-800 group-hover:text-primary transition-colors",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.position," ",(0,a.jsx)("span",{className:"text-gray-300 mx-1",children:"|"})," ",e.dept]})]})]})}),(0,a.jsx)(ek,{className:"text-gray-600 font-medium text-sm",children:(0,H.zy)(e.salaryGroup)}),(0,a.jsx)(ek,{className:"text-center",children:e.finalScore>0?(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)("span",{className:"inline-block font-bold text-gray-800 bg-gray-100 px-2 py-1 rounded-lg min-w-[4rem]",children:[e.finalScore.toFixed(2),"%"]}),(0,a.jsxs)("span",{className:"text-[10px] text-gray-400 mt-1 font-medium",children:["จาก ",e.evaluatorCount,"/",e.totalEvaluators," คน"]})]}):(0,a.jsx)("span",{className:"text-gray-300",children:"-"})}),(0,a.jsx)(ek,{className:"text-center",children:e.isDone?(0,a.jsx)("span",{className:"px-2.5 py-1 text-xs font-bold rounded-full border ".concat(e.levelColor," shadow-sm"),children:e.levelLabel}):(0,a.jsx)("span",{className:"text-gray-300",children:"-"})}),(0,a.jsx)(ek,{className:"text-sm text-gray-500 max-w-xs truncate opacity-70 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)("div",{className:"text-xs text-gray-500 max-w-[200px] truncate",title:"คลิกเพื่อดูรายละเอียด",children:"HIDDEN_SELF"===e.comment?(0,a.jsxs)("span",{className:"text-gray-400 italic flex items-center gap-1",children:[(0,a.jsx)(em.Z,{className:"w-3 h-3"})," สงวนสิทธิ์การเข้าถึง"]}):Array.isArray(e.comment)?e.comment.length+" ความเห็น":e.comment})})]},e.internalId))})]})})})]})}),(0,a.jsx)(eM,{open:!!y,onOpenChange:e=>!e&&w(null),children:(0,a.jsxs)(eZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(eP,{children:[(0,a.jsx)(e$,{className:"flex items-center gap-4",children:y&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K.default,{src:y.img,width:64,height:64,className:"w-16 h-16 rounded-full",alt:y.name}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:y.name}),(0,a.jsxs)("div",{className:"text-sm font-normal text-muted-foreground",children:[y.position," - ",y.dept]})]})]})}),(0,a.jsx)(eK,{children:"รายละเอียดผลการประเมินรายบุคคล"})]}),y&&(()=>{let e=s(y);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)(c,{children:[(0,a.jsx)(m,{className:"pb-2",children:(0,a.jsx)(x,{className:"text-sm font-medium",children:"คะแนนรวม"})}),(0,a.jsx)(u,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[y.finalScore.toFixed(2),"%"]})})]}),(0,a.jsxs)(c,{children:[(0,a.jsx)(m,{className:"pb-2",children:(0,a.jsx)(x,{className:"text-sm font-medium",children:"ระดับ"})}),(0,a.jsx)(u,{children:(0,a.jsx)("span",{className:"px-2 py-1 text-sm font-medium rounded-md border ".concat(y.levelColor),children:y.levelLabel})})]}),(0,a.jsxs)(c,{children:[(0,a.jsx)(m,{className:"pb-2",children:(0,a.jsx)(x,{className:"text-sm font-medium",children:"สถานะ"})}),(0,a.jsx)(u,{children:(0,a.jsx)("div",{className:"text-lg",children:y.isDone?"ประเมินแล้ว":"ยังไม่ครบ"})})]})]}),(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsxs)(ew,{children:[(0,a.jsx)(eC,{children:(0,a.jsxs)(eS,{className:"bg-muted",children:[(0,a.jsx)(eI,{children:"หัวข้อการประเมิน"}),(0,a.jsx)(eI,{className:"w-[100px] text-center",children:"น้ำหนัก"}),(0,a.jsx)(eI,{className:"w-[100px] text-center",children:"คะแนน (1-4)"})]})}),(0,a.jsx)(eE,{children:e.map(e=>{var t;return(0,a.jsxs)(eS,{children:[(0,a.jsxs)(ek,{children:[(0,a.jsx)("div",{className:"font-medium",children:e.text}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]}),(0,a.jsx)(ek,{className:"text-center",children:e.weight}),(0,a.jsx)(ek,{className:"text-center font-bold",children:(null===(t=C[y.internalId])||void 0===t?void 0:t[e.id])||"-"})]},e.id)})})]})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"font-bold text-lg",children:"ความคิดเห็นเพิ่มเติม"}),(()=>{if((null==y?void 0:y.comment)==="HIDDEN_SELF")return(0,a.jsxs)("div",{className:"p-8 bg-gray-50 rounded-xl border border-gray-100 flex flex-col items-center justify-center text-center",children:[(0,a.jsx)("div",{className:"bg-gray-200 p-3 rounded-full mb-3",children:(0,a.jsx)(em.Z,{className:"w-8 h-8 text-gray-400"})}),(0,a.jsx)("h4",{className:"text-gray-600 font-bold",children:"สงวนสิทธิ์การเข้าถึง"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"คุณไม่สามารถดูความคิดเห็นที่ผู้อื่นประเมินถึงคุณได้ตามนโยบายความเป็นส่วนตัว"})]});let e=k[(null==y?void 0:y.internalId)||""]||"-";return Array.isArray(e)?(0,a.jsx)("div",{className:"space-y-4",children:e.map((e,t)=>(0,a.jsxs)("div",{className:"bg-gray-50/50 p-3 rounded-lg border border-gray-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("div",{className:"h-5 w-5 rounded-full bg-indigo-100 flex items-center justify-center text-[9px] font-bold text-indigo-700",children:e.evaluator.charAt(0)}),(0,a.jsx)("span",{className:"text-xs font-bold text-gray-700",children:e.evaluator})]}),(0,a.jsx)("p",{className:"text-gray-600 pl-7",children:e.comment})]},t))}):(0,a.jsx)("p",{className:"text-gray-600 p-4 bg-muted/50 rounded-lg italic text-muted-foreground border",children:e})})()]})]})})(),(0,a.jsx)(ez,{children:(0,a.jsx)(b,{onClick:()=>w(null),children:"ปิด"})})]})})]})},tK=()=>{let{user:e,goBack:t}=(0,r.b)();return e?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 flex items-center justify-center p-4 animate-fade-in relative font-sans",children:[(0,a.jsx)("div",{className:"absolute top-20 left-20 w-96 h-96 bg-indigo-200/20 rounded-full blur-3xl pointer-events-none"}),(0,a.jsx)("div",{className:"absolute bottom-20 right-20 w-80 h-80 bg-cyan-200/20 rounded-full blur-3xl pointer-events-none"}),(0,a.jsx)(b,{onClick:t,variant:"ghost",size:"icon",className:"absolute top-6 left-6 h-10 w-10 rounded-full bg-white/50 backdrop-blur-sm hover:bg-white border border-white/50 shadow-sm z-20",children:(0,a.jsx)(ev.Z,{className:"text-gray-600"})}),(0,a.jsxs)(c,{className:"w-full max-w-md text-center shadow-2xl shadow-indigo-100 bg-white/80 backdrop-blur-md border-white/50 rounded-3xl overflow-hidden relative z-10",children:[(0,a.jsx)("div",{className:"h-32 bg-gradient-to-r from-indigo-500 to-cyan-500"}),(0,a.jsxs)(m,{className:"relative pt-0 pb-6 px-6 -mt-16",children:[(0,a.jsxs)("div",{className:"relative inline-block mx-auto mb-4",children:[(0,a.jsx)(K.default,{src:e.img,width:100,height:100,className:"w-28 h-28 rounded-full border-4 border-white shadow-lg bg-gray-100 object-cover",alt:e.name}),(0,a.jsx)("div",{className:"absolute bottom-1 right-1 w-6 h-6 bg-emerald-500 border-4 border-white rounded-full"})]}),(0,a.jsx)(x,{className:"text-2xl font-bold font-headline text-gray-800 tracking-tight",children:e.name}),(0,a.jsx)(h,{className:"text-gray-500 font-medium",children:e.position})]}),(0,a.jsx)(u,{className:"px-8 pb-8",children:(0,a.jsxs)("div",{className:"text-left space-y-4 bg-gray-50/50 rounded-2xl p-6 border border-gray-100/50",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center group",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-400 group-hover:text-indigo-500 transition-colors",children:"แผนก"}),(0,a.jsx)("span",{className:"font-semibold text-gray-700",children:e.dept})]}),(0,a.jsx)(tm,{className:"bg-gray-100"}),(0,a.jsxs)("div",{className:"flex justify-between items-center group",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-400 group-hover:text-indigo-500 transition-colors",children:"ตำแหน่ง"}),(0,a.jsx)(en,{variant:"secondary",className:"bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border-indigo-100 px-3",children:Z.Sx[e.role]})]}),(0,a.jsx)(tm,{className:"bg-gray-100"}),(0,a.jsxs)("div",{className:"flex justify-between items-center group",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-400 group-hover:text-indigo-500 transition-colors",children:"รหัสพนักงาน"}),(0,a.jsx)("span",{className:"font-mono text-sm font-bold text-gray-600 bg-gray-100 px-2 py-0.5 rounded-md tracking-wider",children:e.orgId})]}),e.isAdmin&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tm,{className:"bg-gray-100"}),(0,a.jsxs)("div",{className:"flex justify-between items-center group",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-400 group-hover:text-indigo-500 transition-colors",children:"สิทธิ์การใช้งาน"}),(0,a.jsx)(en,{className:"bg-gradient-to-r from-purple-600 to-indigo-600 border-0 shadow-sm px-3",children:"Administrator"})]})]})]})})]})]}):null},tV=s(3417),tH=s(44),tG=s(525),tU=()=>{let{goBack:e,allUsers:t,fetchReportData:s,getCriteriaForUser:i,exclusions:n}=(0,r.b)(),{toast:d}=(0,O.pm)(),[o,p]=(0,l.useState)({}),[g,f]=(0,l.useState)(!0),[j,v]=(0,l.useState)(""),[N,y]=(0,l.useState)("all"),[w,C]=(0,l.useState)(!1),[E,S]=(0,l.useState)("กรุณาดำเนินการประเมินให้เรียบร้อย ภายในกำหนด"),[I,k]=(0,l.useState)(!1);l.useEffect(()=>{S(e=>"".concat(e,"\n\n").concat(window.location.origin)),(async()=>{f(!0);let e=await s({raw:!0});console.log("DEBUG: fetchReportData result:",e?Object.keys(e):"null"),e&&e.all_scores?(console.log("DEBUG: all_scores sample keys:",Object.keys(e.all_scores).slice(0,5)),p(e.all_scores)):console.warn("DEBUG: No all_scores found in response"),f(!1)})()},[s]);let A=(0,l.useMemo)(()=>(console.log("DEBUG: Starting evaluatorProgressData calc. AllUsers count:",t.length),t.filter(e=>e.isActive).map((e,s)=>{s<3&&console.log("DEBUG: Processing user ".concat(e.name," (ID: ").concat(e.internalId,")"));let a=(0,H.EQ)(e,t,n).filter(e=>e.role!==Z.K$.COMMITTEE),r=a.length,l=0,d=0,c=0;if(0===r)return{...e,progress:100,completedCount:0,totalCount:0,peopleCompleted:0,peopleTotal:0,isDone:!0,hasDuty:!1};let m=String(e.internalId),x=o[m]||o[Number(e.internalId)]||{};("19"===m||"21"===m)&&console.log("Debug ".concat(e.name," (").concat(m,"):"),{rawScoresKeys:Object.keys(o).slice(0,5),myScoresSize:Object.keys(x).length,foundMyScores:!!o[m],evaluatorIdType:typeof e.internalId,targetsCount:a.length}),a.forEach(e=>{let t=i(e),s=t.length;if(0===s){l++;return}c+=s;let a=x[String(e.internalId)]||{},r=0;t.forEach(e=>{void 0!==a[e.id]&&null!==a[e.id]&&(r++,d++)}),r===s&&l++});let h=r>0?Math.round(l/r*100):0;return{...e,progress:h,completedCount:d,totalCount:c,peopleCompleted:l,peopleTotal:r,isDone:100===h,hasDuty:c>0}})),[t,o,i,n]),T=(0,l.useMemo)(()=>{let e={};return A.forEach(t=>{t.hasDuty&&(e[t.dept]||(e[t.dept]={totalTargets:0,completedTargets:0,totalEvaluators:0,completedEvaluators:0}),e[t.dept].totalEvaluators+=1,e[t.dept].totalTargets+=t.peopleTotal,e[t.dept].completedTargets+=t.peopleCompleted,t.isDone&&(e[t.dept].completedEvaluators+=1))}),Object.entries(e).map(e=>{let[t,s]=e;return{dept:t,progress:s.totalTargets>0?Math.round(s.completedTargets/s.totalTargets*100):0,completed:s.completedEvaluators,total:s.totalEvaluators,targetsCompleted:s.completedTargets,targetsTotal:s.totalTargets}}).sort((e,t)=>t.progress-e.progress)},[A]),_=(0,l.useMemo)(()=>{let e=A.filter(e=>e.hasDuty);return{all:e.length,done:e.filter(e=>e.isDone).length,pending:e.filter(e=>!e.isDone).length}},[A]),M=(0,l.useMemo)(()=>A.filter(e=>e.hasDuty).filter(e=>"done"===N?e.isDone:"pending"!==N||!e.isDone).filter(e=>e.name.toLowerCase().includes(j.toLowerCase())||e.dept.toLowerCase().includes(j.toLowerCase())).sort((e,t)=>{let s=[Z.K$.COMMITTEE,Z.K$.MANAGER,Z.K$.ASST,Z.K$.HEAD,Z.K$.STAFF],a=s.indexOf(e.role),r=s.indexOf(t.role);return a!==r?a-r:e.name.localeCompare(t.name,"th")}),[A,j,N]),D=(0,l.useMemo)(()=>M.filter(e=>!e.isDone&&e.hasDuty&&e.mobile),[M]),F=async()=>{k(!0);try{let e=0,t=D.map(async t=>{if(t.mobile)try{(await fetch("/api/otp/request?mobile_no=".concat(t.mobile,"&msg=").concat(encodeURIComponent(E)))).ok&&e++}catch(e){console.error("Failed to send SMS to ".concat(t.name),e)}});await Promise.all(t),d({title:"ส่งข้อความสำเร็จ",description:"ส่งข้อความแจ้งเตือนเรียบร้อยแล้ว (".concat(e,"/").concat(D.length," คน)")}),C(!1)}catch(e){console.error("SMS Error:",e),d({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถส่งข้อความได้ กรุณาลองใหม่อีกครั้ง",variant:"destructive"})}finally{k(!1)}},P=(0,l.useMemo)(()=>{let e=A.filter(e=>e.hasDuty);if(0===e.length)return 0;let t=e.reduce((e,t)=>e+t.peopleTotal,0),s=e.reduce((e,t)=>e+t.peopleCompleted,0);return t>0?Math.round(s/t*100):0},[A]);return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 flex flex-col animate-fade-in font-sans",children:[(0,a.jsxs)("header",{className:"bg-white/80 backdrop-blur-md shadow-sm px-6 py-4 flex items-center gap-4 sticky top-0 z-20 border-b border-white/20",children:[(0,a.jsx)(b,{onClick:e,variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full hover:bg-gray-100",children:(0,a.jsx)(ev.Z,{className:"h-5 w-5 text-gray-600"})}),(0,a.jsxs)("h1",{className:"text-xl font-bold font-headline text-gray-800 tracking-tight flex items-center gap-2",children:[(0,a.jsx)("span",{className:"bg-purple-100 text-purple-600 p-2 rounded-xl",children:(0,a.jsx)(U.Z,{className:"w-5 h-5"})}),"ติดตามความคืบหน้า (Monitoring)"]}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-3",children:[(0,a.jsxs)(b,{variant:"outline",size:"sm",className:"gap-2 hidden md:flex border-indigo-200 text-indigo-700 hover:bg-indigo-50",onClick:()=>C(!0),disabled:0===D.length,children:[(0,a.jsx)(tV.Z,{className:"w-4 h-4"}),"แจ้งเตือน SMS (",D.length,")"]}),(0,a.jsxs)("div",{className:"text-right hidden md:block",children:[(0,a.jsx)("div",{className:"text-sm font-bold text-gray-700",children:"ภาพรวมทั้งองค์กร"}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[P,"% ผู้ประเมินเสร็จสิ้น"]})]}),(0,a.jsx)("div",{className:"w-32 hidden md:block",children:(0,a.jsx)(ee,{value:P,className:"h-2"})})]})]}),(0,a.jsx)(eM,{open:w,onOpenChange:C,children:(0,a.jsxs)(eZ,{children:[(0,a.jsxs)(eP,{children:[(0,a.jsx)(e$,{children:"ส่ง SMS แจ้งเตือน"}),(0,a.jsxs)(eK,{children:["ส่งข้อความแจ้งเตือนไปยังผู้ที่ยังประเมินไม่เสร็จสิ้นจำนวน ",D.length," คน"]})]}),(0,a.jsxs)("div",{className:"py-4",children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"ข้อความ:"}),(0,a.jsx)(ts,{value:E,onChange:e=>S(e.target.value),placeholder:"ระบุข้อความ...",className:"min-h-[100px]"})]}),(0,a.jsxs)(ez,{children:[(0,a.jsx)(b,{variant:"outline",onClick:()=>C(!1),disabled:I,children:"ยกเลิก"}),(0,a.jsxs)(b,{onClick:F,disabled:I||!E.trim(),children:[I?(0,a.jsx)("span",{className:"animate-spin mr-2",children:"⏳"}):(0,a.jsx)(tV.Z,{className:"w-4 h-4 mr-2"}),"ส่งข้อความ"]})]})]})}),(0,a.jsxs)("main",{className:"p-6 md:p-8 max-w-7xl mx-auto w-full space-y-8",children:[(0,a.jsxs)("section",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,a.jsx)(tH.Z,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"ความคืบหน้าตามสายงาน (Department Progress)"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:T.map(e=>(0,a.jsxs)(c,{className:"border-0 shadow-md hover:shadow-lg transition-all duration-300 ring-1 ring-gray-100 overflow-hidden group",children:[(0,a.jsxs)(m,{className:"pb-2 bg-gradient-to-br from-white to-gray-50/50",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start w-full",children:[(0,a.jsx)(x,{className:"text-base font-bold text-gray-800 line-clamp-1 flex-1",title:e.dept,children:e.dept}),(0,a.jsxs)(en,{variant:100===e.progress?"default":"secondary",className:100===e.progress?"bg-green-500 hover:bg-green-600":"",children:[e.progress,"%"]})]}),(0,a.jsxs)(h,{className:"text-xs",children:["เสร็จสิ้น ",e.targetsCompleted," จาก ",e.targetsTotal," คน"]})]}),(0,a.jsx)(u,{className:"pt-4",children:(0,a.jsx)(ee,{value:e.progress,className:"h-2 ".concat(100===e.progress?"bg-green-100 [&>div]:bg-green-500":"bg-indigo-50 [&>div]:bg-indigo-500")})})]},e.dept))})]}),(0,a.jsxs)("section",{children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(q.Z,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"สถานะผู้ประเมิน (Evaluator Status)"})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-4 w-full md:w-auto",children:[(0,a.jsxs)("div",{className:"flex p-1 bg-white ring-1 ring-gray-200 rounded-2xl shadow-sm",children:[(0,a.jsxs)("button",{onClick:()=>y("all"),className:"px-4 py-1.5 rounded-xl text-xs font-bold transition-all flex items-center gap-2 ".concat("all"===N?"bg-indigo-600 text-white shadow-md":"text-gray-500 hover:bg-gray-50"),children:["ทั้งหมด ",(0,a.jsx)("span",{className:"px-1.5 py-0.5 rounded-md text-[10px] ".concat("all"===N?"bg-white/20":"bg-gray-100"),children:_.all})]}),(0,a.jsxs)("button",{onClick:()=>y("done"),className:"px-4 py-1.5 rounded-xl text-xs font-bold transition-all flex items-center gap-2 ".concat("done"===N?"bg-green-500 text-white shadow-md":"text-gray-500 hover:bg-gray-50"),children:["ครบ ",(0,a.jsx)("span",{className:"px-1.5 py-0.5 rounded-md text-[10px] ".concat("done"===N?"bg-white/20":"bg-gray-100"),children:_.done})]}),(0,a.jsxs)("button",{onClick:()=>y("pending"),className:"px-4 py-1.5 rounded-xl text-xs font-bold transition-all flex items-center gap-2 ".concat("pending"===N?"bg-amber-500 text-white shadow-md":"text-gray-500 hover:bg-gray-50"),children:["ไม่ครบ ",(0,a.jsx)("span",{className:"px-1.5 py-0.5 rounded-md text-[10px] ".concat("pending"===N?"bg-white/20":"bg-gray-100"),children:_.pending})]})]}),(0,a.jsxs)("div",{className:"relative flex-1 md:w-64",children:[(0,a.jsx)(e5.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(R,{placeholder:"ค้นหาผู้ประเมิน...",className:"pl-10 h-10 rounded-full bg-white shadow-sm border-gray-200 focus:border-indigo-300 focus:ring-indigo-100",value:j,onChange:e=>v(e.target.value)})]})]})]}),(0,a.jsx)("div",{className:"bg-white/60 backdrop-blur-xl rounded-3xl shadow-xl shadow-indigo-100/50 border border-white ring-1 ring-gray-200/50 overflow-hidden",children:g?(0,a.jsxs)("div",{className:"p-12 text-center text-gray-500 flex flex-col items-center gap-2",children:[(0,a.jsx)("div",{className:"animate-spin h-6 w-6 border-2 border-indigo-500 border-t-transparent rounded-full"}),"กำลังประมวลผลข้อมูล..."]}):(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-0 divide-x divide-y divide-gray-100",children:[M.map(e=>(0,a.jsxs)("div",{className:"p-4 hover:bg-white/80 transition-colors flex items-center gap-4 group",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(K.default,{src:e.img,width:48,height:48,className:"w-12 h-12 rounded-full border-2 object-cover ".concat(e.isDone?"border-green-500":"border-gray-200 group-hover:border-indigo-300"),alt:e.name}),e.isDone&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 bg-green-500 text-white rounded-full p-0.5 border-2 border-white",children:(0,a.jsx)(tG.Z,{className:"w-3 h-3"})})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-0.5",children:[(0,a.jsx)("h4",{className:"text-sm font-bold text-gray-900 truncate pr-2",children:e.name}),(0,a.jsxs)("span",{className:"text-[10px] font-bold px-1.5 py-0.5 rounded-md ".concat(e.isDone?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"),children:[e.progress,"%"]})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 truncate mb-2",children:[e.position," ",(0,a.jsx)("span",{className:"mx-1",children:"•"})," ",e.peopleTotal," คนที่ต้องประเมิน"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(ee,{value:e.progress,className:"h-1.5 flex-1 ".concat(e.isDone?"[&>div]:bg-green-500 bg-green-100":"[&>div]:bg-purple-500 bg-purple-50")}),(0,a.jsxs)("span",{className:"text-[10px] text-gray-400 font-medium whitespace-nowrap",children:[e.peopleCompleted,"/",e.peopleTotal," คน"]})]})]})]},e.internalId)),0===M.length&&(0,a.jsx)("div",{className:"col-span-full p-12 text-center text-gray-400",children:A.some(e=>e.hasDuty)?"ไม่พบข้อมูลที่ค้นหา":"ยังไม่มีผู้ประเมินที่มีภาระงาน"})]})})]})]})]})};function tL(){let{view:e}=(0,r.b)();return(0,a.jsx)("main",{children:(()=>{switch(e){case"login":default:return(0,a.jsx)(V,{});case"dashboard":return(0,a.jsx)(eg,{});case"admin":return(0,a.jsx)(tI,{});case"evaluation":return(0,a.jsx)(tD,{});case"individual":return(0,a.jsx)(tF,{});case"summary":return(0,a.jsx)(t$,{});case"profile":return(0,a.jsx)(tK,{});case"progress":return(0,a.jsx)(tU,{})}})()})}},9556:function(e,t,s){"use strict";s.d(t,{Toaster:function(){return f}});var a=s(7437),r=s(5153),l=s(2265),i=s(1915),n=s(535),d=s(2489),o=s(4508);let c=i.zt,m=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.l_,{ref:t,className:(0,o.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...r})});m.displayName=i.l_.displayName;let x=(0,n.j)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-2xl border p-4 pr-6 shadow-xl shadow-indigo-500/10 transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full backdrop-blur-md",{variants:{variant:{default:"border-white/50 bg-white/90 text-gray-800",destructive:"destructive group border-red-500/50 bg-red-600/90 text-white shadow-red-500/20"}},defaultVariants:{variant:"default"}}),h=l.forwardRef((e,t)=>{let{className:s,variant:r,...l}=e;return(0,a.jsx)(i.fC,{ref:t,className:(0,o.cn)(x({variant:r}),s),...l})});h.displayName=i.fC.displayName,l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.aU,{ref:t,className:(0,o.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...r})}).displayName=i.aU.displayName;let u=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.x8,{ref:t,className:(0,o.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...r,children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})});u.displayName=i.x8.displayName;let p=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.Dx,{ref:t,className:(0,o.cn)("text-sm font-semibold",s),...r})});p.displayName=i.Dx.displayName;let g=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.dk,{ref:t,className:(0,o.cn)("text-sm opacity-90",s),...r})});function f(){let{toasts:e}=(0,r.pm)();return(0,a.jsxs)(c,{duration:3e3,children:[e.map(function(e){let{id:t,title:s,description:r,action:l,...i}=e;return(0,a.jsxs)(h,{...i,children:[(0,a.jsxs)("div",{className:"grid gap-1",children:[s&&(0,a.jsx)(p,{children:s}),r&&(0,a.jsx)(g,{children:r})]}),l,(0,a.jsx)(u,{})]},t)}),(0,a.jsx)(m,{})]})}g.displayName=i.dk.displayName},5153:function(e,t,s){"use strict";s.d(t,{pm:function(){return x}});var a=s(2265);let r=0,l=new Map,i=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},n=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?i(s):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],o={toasts:[]};function c(e){o=n(o,e),d.forEach(e=>{e(o)})}function m(e){let{...t}=e,s=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:s});return c({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function x(){let[e,t]=a.useState(o);return a.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:m,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},8685:function(e,t,s){"use strict";s.d(t,{CT:function(){return l},Ji:function(){return a},K$:function(){return n},Sx:function(){return d},Ys:function(){return h},mq:function(){return r},rv:function(){return i},wA:function(){return x},xm:function(){return p},ys:function(){return u}});let a="2.0.0",r=!0,l="/kuscc-eval/api/proxy",i={บัญชี:1,การเงินและลงทุน:.85,ไอที:1,สินเชื่อและกำแพงแสน:.9,บริหารทั่วไป:1,รองผู้จัดการ:1,ผู้จัดการ:1,คณะกรรมการ:1},n={COMMITTEE:"COMMITTEE",MANAGER:"MANAGER",ASST:"ASST",HEAD:"HEAD",STAFF:"STAFF"},d={COMMITTEE:"คณะกรรมการ",MANAGER:"ผู้จัดการ",ASST:"รอง/ผู้ช่วย",HEAD:"หัวหน้าฝ่าย",STAFF:"เจ้าหน้าที่"},o=[{id:"1.1",text:"ปริมาณผลงาน (Quantity)",weight:20,description:"พิจารณาจากจำนวนปริมาณงานที่ปฏิบัติได้เทียบกับเป้าหมาย หรือภาระงานที่ได้รับมอบหมายในความรับผิดชอบ",category:"PERF"},{id:"1.2",text:"คุณภาพผลงาน (Quality)",weight:20,description:"ความถูกต้องแม่นยำของงาน ความเป็นระเบียบเรียบร้อย ความคุ้มค่า และการลดความสูญเสีย/ข้อผิดพลาด",category:"PERF"},{id:"1.3",text:"ความทันเวลา (Timeliness)",weight:20,description:"ความสามารถในการปฏิบัติงานให้เสร็จตามกำหนดเวลาที่นัดหมาย หรือทันต่อความต้องการใช้งานของสมาชิก",category:"PERF"},{id:"1.4",text:"ผลสัมฤทธิ์ของงาน (Achievement)",weight:20,description:"พิจารณาจากผลงานที่ส่งผลต่อความสำเร็จของส่วนงานหรือเป้าหมายหลักของสหกรณ์ฯ ในภาพรวม",category:"PERF"},{id:"1.5",text:"ความรับผิดชอบ (Responsibility)",weight:20,description:"ความทุ่มเท ความขยันหมั่นเพียร และความรับผิดชอบต่อหน้าที่ที่ได้รับมอบหมายจนสำเร็จลุล่วง",category:"PERF"}],c=[{id:"2.1",text:"ความสามารถในการปฏิบัติงาน",weight:20,description:"ความรู้ความเข้าใจในระเบียบ ข้อบังคับ และขั้นตอนการปฏิบัติงานในหน้าที่ของตนเอง",category:"CHAR"},{id:"2.2",text:"การแก้ไขปัญหาสถานการณ์เฉพาะหน้า",weight:20,description:"ความสามารถในการตัดสินใจแก้ไขปัญหาที่เกิดขึ้นอย่างกะทันหันได้อย่างถูกต้องและเหมาะสม",category:"CHAR"},{id:"2.3",text:"การเรียนรู้และพัฒนาปรับปรุงงาน",weight:20,description:"ความกระตือรือร้นในการศึกษาความรู้ใหม่ๆ และนำมาปรับปรุงกระบวนการทำงานให้ดีขึ้น",category:"CHAR"},{id:"2.4",text:"ความคิดริเริ่มสร้างสรรค์",weight:10,description:"การเสนอแนะแนวคิดใหม่ๆ หรือวิธีทำงานรูปแบบใหม่ที่เป็นประโยชน์ต่อส่วนงาน",category:"CHAR"},{id:"2.5",text:"การรักษาวินัย/มารยาท",weight:10,description:"การปฏิบัติตามระเบียบวินัย การแต่งกาย การมาทำงานตรงเวลา และกิริยามารยาทต่อเพื่อนร่วมงาน",category:"CHAR"},{id:"2.6",text:"การให้ความร่วมมือ/ประสานงาน",weight:10,description:"การทำงานร่วมกับผู้อื่นได้อย่างราบรื่น การช่วยเหลือเพื่อนร่วมงาน และการประสานงานข้ามส่วนงาน",category:"CHAR"},{id:"2.7",text:"มนุษยสัมพันธ์/ทัศนคติที่ดีต่อองค์กร",weight:10,description:"การมีทัศนคติเชิงบวกต่อสหกรณ์ฯ การแสดงออกที่เป็นมิตร และความจงรักภักดีต่อองค์กร",category:"CHAR"},{id:"2.8",text:"การมีส่วนร่วมในกิจกรรมสหกรณ์",weight:10,description:"การเข้าร่วมกิจกรรมที่สหกรณ์ฯ จัดขึ้น เช่น งานสวัสดิการ งานอาสา หรือกิจกรรมสัมพันธ์ต่างๆ",category:"CHAR"},{id:"2.9",text:"การให้บริการด้วยจิตบริการ (Service Mind)",weight:10,description:"ความเต็มใจในการให้บริการสมาชิกด้วยความยิ้มแย้ม แจ่มใส และความสุภาพเรียบร้อย",category:"CHAR"}],m=[{id:"2.1-E",text:"การกำหนดทิศทางและเป้าหมาย",weight:20,description:"ความสามารถในการวางแผนงาน กำหนดทิศทาง และเป้าหมายระยะสั้น-ยาว ให้แก่ส่วนงาน",category:"EXEC"},{id:"2.2-E",text:"ทักษะในการสื่อสารจูงใจ",weight:20,description:"ความสามารถในการถ่ายทอดคำสั่ง นโยบาย และสร้างแรงจูงใจให้ผู้ใต้บังคับบัญชาปฏิบัติงานอย่างเต็มใจ",category:"EXEC"},{id:"2.3-E",text:"ความคิดริเริ่มสร้างสรรค์เชิงรุก",weight:20,description:"การมองหาโอกาสในการพัฒนาธุรกิจหรือบริการใหม่ๆ เพื่อความยั่งยืนของสหกรณ์ฯ",category:"EXEC"},{id:"2.4-E",text:"ความสามารถในการตัดสินใจ",weight:20,description:"ความกล้าหาญและรอบคอบในการตัดสินใจในเรื่องสำคัญๆ โดยคำนึงถึงประโยชน์สูงสุดของส่วนรวม",category:"EXEC"},{id:"2.5-E",text:"ทักษะในการฟังและรับความคิดเห็น",weight:10,description:"การเปิดใจรับฟังความคิดเห็นจากผู้ใต้บังคับบัญชาและนำมาปรับปรุงแก้ไขการทำงาน",category:"EXEC"},{id:"2.6-E",text:"ความสามารถในการแก้ปัญหาความขัดแย้ง",weight:20,description:"ความยุติธรรมและการจัดการปัญหาความขัดแย้งภายในกลุ่มงานได้อย่างมีประสิทธิภาพ",category:"EXEC"},{id:"2.7-E",text:"การมอบหมายและติดตามงาน",weight:20,description:"การเลือกคนที่เหมาะสมกับงาน (Put the right man on the right job) และการติดตามผลอย่างต่อเนื่อง",category:"EXEC"},{id:"2.8-E",text:"การเป็นผู้สนับสนุนและสร้างทีมงาน",weight:10,description:"การสนับสนุนเครื่องมือและทรัพยากร รวมถึงการสร้างบรรยากาศการทำงานที่ดีเป็นทีม",category:"EXEC"},{id:"2.9-E",text:"การเรียนรู้และพัฒนาตนเองอย่างต่อเนื่อง",weight:10,description:"การเป็นแบบอย่างที่ดีในการศึกษาหาความรู้และพัฒนาศักยภาพผู้บริหารอยู่เสมอ",category:"EXEC"},{id:"2.10-E",text:"การเป็นผู้สอนงาน (Coaching)",weight:10,description:"ความสามารถในการสอนงานและถ่ายทอดประสบการณ์เพื่อพัฒนาขีดความสามารถของลูกน้อง",category:"EXEC"},{id:"2.11-E",text:"การแก้ปัญหาสถานการณ์เฉพาะหน้า",weight:20,description:"ภาวะผู้นำในการแก้ไขวิกฤตหรือปัญหาที่ซับซ้อนภายใต้แรงกดดัน",category:"EXEC"},{id:"2.12-E",text:"การมีส่วนร่วมในกิจกรรมสหกรณ์",weight:10,description:"การเป็นผู้นำในการเข้าร่วมกิจกรรมของสหกรณ์ฯ และงานสังคมส่วนรวม",category:"EXEC"},{id:"2.13-E",text:"การให้บริการด้วยจิตบริการ (Service Mind)",weight:10,description:"ความแสดงภาพลักษณ์ที่ดีในการให้บริการ และการสนับสนุนวัฒนธรรมการบริการในส่วนงาน",category:"EXEC"}];n.STAFF,[...o,...c],n.HEAD,[...o,...m],n.ASST,[...o,...m],n.MANAGER,[...o,...m],n.COMMITTEE;let x=Array.from(new Map([...o,...c,...m].map(e=>[e.id,e])).values()),h=[{id:"PERF",name:"ด้านผลการปฏิบัติงาน (Performance)",color:"bg-blue-50 text-blue-700"},{id:"CHAR",name:"ด้านคุณลักษณะ (Officer Characteristics)",color:"bg-emerald-50 text-emerald-700"},{id:"EXEC",name:"ด้านคุณลักษณะ (Executive Characteristics)",color:"bg-purple-50 text-purple-700"}],u={PERF:.6,CHAR:.4,EXEC:.4},p={MANAGER:{Superior:0,Committee:.8,Subordinate:.2},ASST:{Superior:.5,Committee:.3,Subordinate:.2},HEAD:{Superior:.4,Committee:.4,Subordinate:.2},STAFF:{Superior:.6,Committee:.2,Subordinate:.2},COMMITTEE:{Superior:0,Committee:0,Subordinate:0}}},308:function(e,t,s){"use strict";s.d(t,{EQ:function(){return h},EZ:function(){return d},MX:function(){return r},_0:function(){return n},_t:function(){return c},jl:function(){return u},pV:function(){return i},p_:function(){return x},tf:function(){return p},wX:function(){return m},zy:function(){return l}});var a=s(8685);let r=e=>{if(null==e)return"ไม่จัดกลุ่ม";let t=parseInt(String(e));return t>1e5?"เกิน 100,000":t>5e4?"เกิน 50,000":t>4e4?"เกิน 40,000":t>3e4?"เกิน 30,000":t>2e4?"เกิน 20,000":"ไม่เกิน 20,000"},l=e=>{if(!e||"N/A"===e||"ไม่จัดกลุ่ม"===e)return"-";let t=e.match(/^([A-Z0-9]+)\./);return t?"Gr.".concat(t[1]):e},i=e=>e?e.includes("กรรมการ")?a.K$.COMMITTEE:!e.includes("ผู้จัดการ")||e.includes("ผู้ช่วย")||e.includes("รอง")?e.includes("รอง")||e.includes("ผู้ช่วย")?a.K$.ASST:e.includes("หัวหน้า")?a.K$.HEAD:a.K$.STAFF:a.K$.MANAGER:a.K$.STAFF,n=e=>e>=90?{label:"ดีมาก",color:"text-emerald-700 bg-emerald-100 border-emerald-200"}:e>=75?{label:"ดี",color:"text-blue-700 bg-blue-100 border-blue-200"}:e>=60?{label:"พอใช้",color:"text-orange-700 bg-orange-100 border-orange-200"}:{label:"ปรับปรุง",color:"text-red-700 bg-red-100 border-red-200"},d=(e,t)=>{let s="data:text/csv;charset=utf-8,"+encodeURIComponent("\uFEFF"+t),a=document.createElement("a");a.setAttribute("href",s),a.setAttribute("download",e),document.body.appendChild(a),a.click(),document.body.removeChild(a)},o=1,c=()=>"U_".concat(Date.now(),"_").concat(o++),m=e=>"https://picsum.photos/seed/".concat(e,"/100/100"),x=(e,t,s)=>s.some(s=>(s.evaluatorId===e||s.evaluator_id===e)&&(s.targetId===t||s.target_id===t)),h=(e,t,s)=>{if(!e)return[];let r=[],l=e=>{t.filter(t=>t.parentInternalId===e).forEach(e=>{e.isActive&&(r.push({...e,type:"Performance (Down)"}),l(e.internalId))})};return e.role===a.K$.COMMITTEE?t.filter(t=>[a.K$.MANAGER,a.K$.ASST].includes(t.role)&&t.orgId!==e.orgId&&t.isActive).forEach(e=>{r.push({...e,type:"Performance (Committee)"})}):([a.K$.MANAGER,a.K$.ASST,a.K$.HEAD].includes(e.role)&&l(e.internalId),[a.K$.ASST,a.K$.HEAD,a.K$.STAFF].includes(e.role)&&(e=>{let s=e.parentInternalId;for(;s;){let e=t.find(e=>e.internalId===s);if(e&&e.isActive)r.push({...e,type:"Feedback (Up - 20%)"}),s=e.parentInternalId;else break}})(e)),r.filter(t=>!x(e.orgId,t.orgId,s))};function u(e,t,s,a,r,l,i){let n={Superior:[],Committee:[],Subordinate:[]};s.forEach(t=>{if(t.internalId===e.internalId)return;let a=h(t,s,i).find(t=>t.internalId===e.internalId);a&&(a.type.includes("Performance (Down)")?n.Superior.push(t.internalId):a.type.includes("Performance (Committee)")?n.Committee.push(t.internalId):a.type.includes("Feedback (Up")&&n.Subordinate.push(t.internalId))});let d={Superior:0,Committee:0,Subordinate:0},o=r[e.role]||{Superior:0,Committee:0,Subordinate:0};Object.keys(n).forEach(s=>{let r=n[s];if(0===r.length)return;let i=0,o=0;r.forEach(s=>{var r;let n=null===(r=t[s])||void 0===r?void 0:r[e.internalId];if(!n)return;let d=a.filter(e=>"PERF"===e.category),c=a.filter(e=>"CHAR"===e.category||"EXEC"===e.category),m=e=>{if(0===e.length)return 0;let t=0,s=0,a=0;return(e.forEach(e=>{let r=n[e.id];r&&(t+=r/4*e.weight,s+=e.weight,a++)}),0===a||0===s)?0:t/s*100},x=m(d),h=m(c),u=x*(l.PERF||.6)+h*(l.CHAR||l.EXEC||.4);i+=u,o++}),o>0&&(d[s]=i/o)});let c=0,m=0;return(Object.keys(d).forEach(e=>{let t=o[e];t>0&&d[e]>0&&(c+=d[e]*t,m+=t)}),0===m)?0:c/m}function p(e,t,s){let a=t[e]||{},r=0,l=0;return s.length>0&&s.every(e=>a[e.id]>0)?(s.forEach(e=>{let t=a[e.id];void 0!==t&&t>0&&(r+=t/4*e.weight),l+=e.weight}),0===l)?0:r/l*100:0}},4508:function(e,t,s){"use strict";s.d(t,{cn:function(){return l}});var a=s(1994),r=s(3335);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}},7960:function(){}},function(e){e.O(0,[587,425,695,971,117,744],function(){return e(e.s=6534)}),_N_E=e.O()}]);